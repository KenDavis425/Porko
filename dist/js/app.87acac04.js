(()=>{"use strict";var e={630:(e,t,a)=>{var s=a(751),n=a(641),l=a(33);const r={id:"app"},o={class:"sidebar"},i={class:"sidebar-top"},u={key:0,xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},d={key:1,src:"/logo.svg",class:"sidebar-toggle-logo",alt:"Expand menu"},c={key:0,class:"sidebar-header"},v=["src"],p={class:"sidebar-user"},g={class:"sidebar-nav"},w={class:"sidebar-bottom"},k={class:"app-version"},m=["disabled"],h={key:5,class:"sidebar-status",style:{"font-size":"0.8em",color:"#666",padding:"0.2em 0.5em"}},L={class:"main-content"};function f(e,t,a,s,f,y){return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("div",{class:(0,l.C4)(["main-layout",{"sidebar-collapsed":s.isSidebarCollapsed}])},[(0,n.Lk)("aside",o,[(0,n.Lk)("div",i,[(0,n.Lk)("button",{class:"sidebar-toggle",onClick:t[0]||(t[0]=(...e)=>s.toggleSidebar&&s.toggleSidebar(...e)),title:"Toggle Sidebar"},[s.isSidebarCollapsed?((0,n.uX)(),(0,n.CE)("img",d)):((0,n.uX)(),(0,n.CE)("svg",u,t[16]||(t[16]=[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"},null,-1),(0,n.Lk)("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},null,-1)])))]),t[27]||(t[27]=(0,n.Lk)("div",{class:"sidebar-branding"},[(0,n.Lk)("img",{src:"/logo.svg",alt:"PorkHub Logo",class:"sidebar-logo"}),(0,n.Lk)("h1",{class:"sidebar-title"},"PorkHub")],-1)),s.user?((0,n.uX)(),(0,n.CE)("div",c,[(0,n.Lk)("img",{src:s.user.photoURL||"https://cdn-icons-png.flaticon.com/512/149/149071.png",class:"sidebar-avatar",alt:"User Avatar",referrerpolicy:"no-referrer"},null,8,v),(0,n.Lk)("div",p,(0,l.v_)(s.user.displayName),1)])):(0,n.Q3)("",!0),(0,n.Lk)("nav",g,[(0,n.Lk)("button",{class:(0,l.C4)(["sidebar-link",{active:"home"===s.currentPage}]),onClick:t[1]||(t[1]=(...e)=>s.goToHome&&s.goToHome(...e)),title:"Home"},t[17]||(t[17]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"})],-1),(0,n.Lk)("span",null,"Home",-1)]),2),(0,n.Lk)("button",{class:(0,l.C4)(["sidebar-link",{active:"leaderboard"===s.currentPage}]),onClick:t[2]||(t[2]=(...e)=>s.goToLeaderboard&&s.goToLeaderboard(...e)),title:"Leaderboard"},t[18]||(t[18]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-8h4v8z"})],-1),(0,n.Lk)("span",null,"Leaderboard",-1)]),2),(0,n.Lk)("button",{class:(0,l.C4)(["sidebar-link",{active:"restaurants"===s.currentPage}]),onClick:t[3]||(t[3]=(...e)=>s.goToRestaurants&&s.goToRestaurants(...e)),title:"Restaurants"},t[19]||(t[19]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M16 6v8h3v8h-3v-2h-2v2h-2v-2h-2v2H8v-2H6v2H3v-8h3V6c0-3.31 2.69-6 6-6s6 2.69 6 6zm-2 0c0-2.21-1.79-4-4-4s-4 1.79-4 4v8h8V6zm-5 3h2v2h-2z"})],-1),(0,n.Lk)("span",null,"Restaurants",-1)]),2),(0,n.Lk)("button",{class:(0,l.C4)(["sidebar-link",{active:"recommendations"===s.currentPage}]),onClick:t[4]||(t[4]=(...e)=>s.goToRecommendations&&s.goToRecommendations(...e)),title:"Recommendations"},t[20]||(t[20]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"})],-1),(0,n.Lk)("span",null,"Recommendations",-1)]),2),s.user?((0,n.uX)(),(0,n.CE)("button",{key:0,class:(0,l.C4)(["sidebar-link",{active:"review"===s.currentPage}]),onClick:t[5]||(t[5]=(...e)=>s.goToReview&&s.goToReview(...e)),title:"Write a Review"},t[21]||(t[21]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm-1.5 9h-2v-2h2v2zm5 0h-2v-2h2v2zm-2.5-4h-2V5h2v2z"})],-1),(0,n.Lk)("span",null,"Write a Review",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:1,class:(0,l.C4)(["sidebar-link",{active:"user-search"===s.currentPage}]),onClick:t[6]||(t[6]=(...e)=>s.goToUserSearch&&s.goToUserSearch(...e)),title:"Follow Users"},t[22]||(t[22]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.41-1.41L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zM12 10V7H8v3H5v2h3v3h2v-3h3v-2h-3z"})],-1),(0,n.Lk)("span",null,"Follow Users",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:2,class:(0,l.C4)(["sidebar-link",{active:"bucket-list"===s.currentPage}]),onClick:t[7]||(t[7]=(...e)=>s.goToBucketList&&s.goToBucketList(...e)),title:"My Bucket List"},t[23]||(t[23]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M18 7h-2.06c-.33-3.2-2.46-5.8-5.94-5.8S4.39 3.8 4.06 7H2v12h16V7zM6.14 7c.2-1.92 1.6-3.48 3.86-3.8A4.002 4.002 0 0 1 14 7h-2.14c-.2-1.92-1.6-3.48-3.86-3.8zM16 17H4v-8h12v8z"})],-1),(0,n.Lk)("span",null,"My Bucket List",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:3,class:(0,l.C4)(["sidebar-link",{active:"my-reviews"===s.currentPage}]),onClick:t[8]||(t[8]=(...e)=>s.goToMyReviews&&s.goToMyReviews(...e)),title:"My Reviews"},t[24]||(t[24]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"})],-1),(0,n.Lk)("span",null,"My Reviews",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:4,class:(0,l.C4)(["sidebar-link",{active:"followers"===s.currentPage}]),onClick:t[9]||(t[9]=(...e)=>s.goToFollowers&&s.goToFollowers(...e)),title:"My Followers"},t[25]||(t[25]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})],-1),(0,n.Lk)("span",null,"My Followers",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:5,class:(0,l.C4)(["sidebar-link",{active:"following"===s.currentPage}]),onClick:t[10]||(t[10]=(...e)=>s.goToFollowing&&s.goToFollowing(...e)),title:"Following"},t[26]||(t[26]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("circle",{cx:"6.18",cy:"17.82",r:"2.18"}),(0,n.Lk)("path",{d:"M4 4.44v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9zM4 10.1v2.83c2.39 0 4.33 1.94 4.33 4.33h2.83c0-3.98-3.23-7.16-7.16-7.16z"})],-1),(0,n.Lk)("span",null,"Following",-1)]),2)):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",w,[s.isAdmin?((0,n.uX)(),(0,n.CE)("button",{key:0,class:(0,l.C4)(["sidebar-link",{active:"database-stats"===s.currentPage}]),onClick:t[11]||(t[11]=(...e)=>s.goToDatabaseStats&&s.goToDatabaseStats(...e)),title:"Database Stats"},t[28]||(t[28]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"})],-1),(0,n.Lk)("span",null,"Database Stats",-1)]),2)):(0,n.Q3)("",!0),s.isAdmin?((0,n.uX)(),(0,n.CE)("button",{key:1,class:(0,l.C4)(["sidebar-link",{active:"backfill-admin"===s.currentPage}]),onClick:t[12]||(t[12]=(...e)=>s.goToBackfillAdmin&&s.goToBackfillAdmin(...e)),title:"Backfill Admin"},t[29]||(t[29]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M13 3a9 9 0 1 0 8.95 8H19a7 7 0 1 1-6.97-6V3zM12 8v5l4 2"})],-1),(0,n.Lk)("span",null,"Backfill Admin",-1)]),2)):(0,n.Q3)("",!0),s.user?((0,n.uX)(),(0,n.CE)("button",{key:2,class:"sidebar-link",onClick:t[13]||(t[13]=(...e)=>s.logout&&s.logout(...e)),title:"Logout"},t[30]||(t[30]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"})],-1),(0,n.Lk)("span",null,"Logout",-1)]))):((0,n.uX)(),(0,n.CE)("button",{key:3,class:"login-btn-sidebar",onClick:t[14]||(t[14]=(...e)=>s.loginWithGoogle&&s.loginWithGoogle(...e)),title:"Login with Google"},t[31]||(t[31]=[(0,n.Fv)('<span>Login with</span><svg viewBox="0 0 48 48" width="22px" height="22px"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>',2)]))),(0,n.Lk)("div",k,"v"+(0,l.v_)(s.appVersion),1),s.isAdmin?((0,n.uX)(),(0,n.CE)("button",{key:4,class:"sidebar-link",disabled:s.backfillInProgress,onClick:t[15]||(t[15]=(...e)=>s.runBackfill&&s.runBackfill(...e)),title:"Backfill review counts"},[t[32]||(t[32]=(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20px",viewBox:"0 0 24 24",width:"20px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M13 3a9 9 0 1 0 8.95 8H19a7 7 0 1 1-6.97-6V3zM12 8v5l4 2"})],-1)),(0,n.Lk)("span",null,(0,l.v_)(s.backfillInProgress?"Backfilling...":"Backfill Reviews"),1)],8,m)):(0,n.Q3)("",!0),s.backfillStatus?((0,n.uX)(),(0,n.CE)("div",h,(0,l.v_)(s.backfillStatus),1)):(0,n.Q3)("",!0)])]),(0,n.Lk)("main",L,[((0,n.uX)(),(0,n.Wv)(n.PR,{include:"Home"},[((0,n.uX)(),(0,n.Wv)((0,n.$y)(s.currentComponent),{user:s.user,onReviewed:s.goToHome,onCheckInAt:s.reviewAt,onReviewAt:s.reviewAt,onGoToReview:s.goToReview,"selected-restaurant-id":s.selectedRestaurantForReview},null,40,["user","onReviewed","onCheckInAt","onReviewAt","onGoToReview","selected-restaurant-id"]))],1024))])],2)])}const y={class:"home-page"},C={key:0,class:"location-prompt-banner"},b={key:1,class:"location-prompt-banner warning"},R={key:2,class:"sort-toggle"},E={class:"feed"},M={key:0,class:"loading-indicator"},x={key:1},I={key:0,class:"no-posts-message"},X={key:0},_={key:1},z={class:"post-header"},A=["src"],U={class:"post-info"},S={class:"user-line"},F={class:"user-name"},K={key:0,class:"medal"},P={class:"post-date"},V={class:"post-content"},H={class:"post-title-line"},B={class:"restaurant-title-group"},Q={class:"restaurant-name"},J=["onClick","title"],T={key:0,class:"distance"},G={key:0,class:"restaurant-location"},N={class:"review-body"},$={key:0,class:"review-text"},D=["src"],W={key:2,class:"tags-container"},O={ref:"loadMoreTrigger"},j={key:1,class:"loading-indicator"};function q(e,t,a,s,r,o){const i=(0,n.g2)("StarRating"),u=(0,n.g2)("Comments");return(0,n.uX)(),(0,n.CE)("div",y,["prompt"===s.locationPermission?((0,n.uX)(),(0,n.CE)("div",C,[t[3]||(t[3]=(0,n.Lk)("div",{class:"banner-content"},[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})]),(0,n.Lk)("p",null,"Share your location to see posts and restaurants near you!")],-1)),(0,n.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>s.requestLocationAccess&&s.requestLocationAccess(...e)),class:"btn-primary"},"Share Location")])):(0,n.Q3)("",!0),"denied"===s.locationPermission?((0,n.uX)(),(0,n.CE)("div",b,t[4]||(t[4]=[(0,n.Lk)("div",{class:"banner-content"},[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"})]),(0,n.Lk)("p",null,"Location access is denied. To see local content, please enable location services for this site in your browser settings.")],-1)]))):(0,n.Q3)("",!0),s.userLocation?((0,n.uX)(),(0,n.CE)("div",R,[(0,n.Lk)("button",{onClick:t[1]||(t[1]=e=>s.setSortOrder("time")),class:(0,l.C4)({active:"time"===s.sortOrder})},"Most Recent",2),(0,n.Lk)("button",{onClick:t[2]||(t[2]=e=>s.setSortOrder("distance")),class:(0,l.C4)({active:"distance"===s.sortOrder})},"Nearby",2)])):(0,n.Q3)("",!0),(0,n.Lk)("div",E,[s.loading?((0,n.uX)(),(0,n.CE)("div",M,"Loading feed...")):((0,n.uX)(),(0,n.CE)("div",x,[0===s.posts.length?((0,n.uX)(),(0,n.CE)("div",I,[a.user?((0,n.uX)(),(0,n.CE)("div",X,t[5]||(t[5]=[(0,n.Lk)("h3",null,"Your Feed is Empty",-1),(0,n.Lk)("p",null,"Follow some users to see their reviews here, or check out the Restaurants page to find new places.",-1)]))):((0,n.uX)(),(0,n.CE)("div",_,t[6]||(t[6]=[(0,n.Lk)("h3",null,"Welcome to PorkHub!",-1),(0,n.Lk)("p",null,"There are no reviews to show right now. Check out the Restaurants page to discover new places!",-1)])))])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.posts,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"post-card"},[(0,n.Lk)("div",z,[(0,n.Lk)("img",{src:e.userPhoto||"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"User",class:"user-avatar",referrerpolicy:"no-referrer"},null,8,A),(0,n.Lk)("div",U,[(0,n.Lk)("div",S,[(0,n.Lk)("span",F,(0,l.v_)(e.userName),1),e.medal?((0,n.uX)(),(0,n.CE)("span",K,(0,l.v_)(e.medal),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",P,(0,l.v_)(e.createdAt.toDate().toLocaleString()),1)])]),(0,n.Lk)("div",V,[(0,n.Lk)("div",H,[(0,n.Lk)("div",B,[(0,n.Lk)("h2",Q,(0,l.v_)(e.restaurantName),1),a.user?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:t=>s.toggleBucketList(e),class:(0,l.C4)(["action-btn bucket-list-btn",{"in-bucket-list":s.isInBucketList(e.restaurantId)}]),title:s.isInBucketList(e.restaurantId)?"In Bucket List":"Add to Bucket List"},t[7]||(t[7]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20px",viewBox:"0 0 24 24",width:"20px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M18 7h-2.06c-.33-3.2-2.46-5.8-5.94-5.8S4.39 3.8 4.06 7H2v12h16V7zM6.14 7c.2-1.92 1.6-3.48 3.86-3.8A4.002 4.002 0 0 1 14 7h-2.14c-.2-1.92-1.6-3.48-3.86-3.8zM16 17H4v-8h12v8z"})],-1)]),10,J)):(0,n.Q3)("",!0)]),null!==e.distance?((0,n.uX)(),(0,n.CE)("div",T,(0,l.v_)(e.distance.toFixed(1))+" miles away ",1)):(0,n.Q3)("",!0)]),e.restaurantCity||e.restaurantState?((0,n.uX)(),(0,n.CE)("div",G,[(0,n.eW)((0,l.v_)(e.restaurantCity),1),e.restaurantCity&&e.restaurantState?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.eW)(", ")],64)):(0,n.Q3)("",!0),(0,n.eW)((0,l.v_)(e.restaurantState),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",N,[(0,n.bF)(i,{rating:e.rating},null,8,["rating"]),e.text?((0,n.uX)(),(0,n.CE)("p",$,'"'+(0,l.v_)(e.text)+'"',1)):(0,n.Q3)("",!0),e.photoURL?((0,n.uX)(),(0,n.CE)("img",{key:1,src:e.photoURL,alt:"Review photo",class:"review-photo"},null,8,D)):(0,n.Q3)("",!0),e.tags&&e.tags.length>0?((0,n.uX)(),(0,n.CE)("div",W,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.tags,e=>((0,n.uX)(),(0,n.CE)("span",{key:e,class:"tag"},(0,l.v_)(e),1))),128))])):(0,n.Q3)("",!0)]),(0,n.bF)(u,{"post-id":e.id,user:a.user,"post-type":"reviews","post-author-id":e.userId},null,8,["post-id","user","post-author-id"])])]))),128)),(0,n.Lk)("div",O,null,512),s.loadingMore?((0,n.uX)(),(0,n.CE)("div",j,"Loading more...")):(0,n.Q3)("",!0)]))])])}var Z=a(953),Y=a(223),ee=a(962),te=a(185),ae=a(993);const se={apiKey:"AIzaSyDxzi70xuS1KxemDBF1logZ6zyHxINFfp4",authDomain:"porko-c0f87.firebaseapp.com",projectId:"porko-c0f87",storageBucket:"porko-c0f87.firebasestorage.app",messagingSenderId:"1050714930836",appId:"1:1050714930836:web:5b4c9bdf93e95748a23e81",measurementId:"G-3LCKP815FM"},ne=(0,Y.Wp)(se),le=(0,ee.xI)(ne),re=new ee.HF,oe=(0,te.aU)(ne),ie=(0,ae.c7)(ne),ue={class:"comments-section"},de={class:"comment-list"},ce=["src","alt"],ve={class:"comment-content"},pe={class:"comment-header"},ge={class:"comment-user-name"},we={class:"comment-date"},ke={key:0},me={class:"comment-text"},he={class:"comment-actions"},Le=["onClick"],fe=["onClick"],ye={key:1,class:"edit-comment"},Ce={class:"edit-actions"},be={key:0,class:"add-comment"},Re=["disabled"],Ee={key:1,class:"add-comment-login-prompt"};function Me(e,t,a,r,o,i){return(0,n.uX)(),(0,n.CE)("div",ue,[(0,n.Lk)("div",de,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.comments,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"comment"},[(0,n.Lk)("img",{src:e.userPhoto||"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:e.userName,class:"comment-user-photo",referrerpolicy:"no-referrer"},null,8,ce),(0,n.Lk)("div",ve,[(0,n.Lk)("div",pe,[(0,n.Lk)("span",ge,(0,l.v_)(e.userName),1),(0,n.Lk)("span",we,(0,l.v_)(r.formatDate(e.createdAt)),1)]),r.editingCommentId!==e.id?((0,n.uX)(),(0,n.CE)("div",ke,[(0,n.Lk)("p",me,(0,l.v_)(e.text),1),(0,n.Lk)("div",he,[r.canEdit(e)?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:t=>r.startEditing(e),class:"action-btn"},"Edit",8,Le)):(0,n.Q3)("",!0),r.canDelete(e)?((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:t=>r.deleteComment(e.id),class:"action-btn delete"},"Delete",8,fe)):(0,n.Q3)("",!0)])])):((0,n.uX)(),(0,n.CE)("div",ye,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.editingText=e),onKeyup:t[1]||(t[1]=(0,s.jR)((...e)=>r.saveEdit&&r.saveEdit(...e),["enter"])),class:"edit-input"},null,544),[[s.Jo,r.editingText]]),(0,n.Lk)("div",Ce,[(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.saveEdit&&r.saveEdit(...e)),class:"btn-primary"},"Save"),(0,n.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.cancelEdit&&r.cancelEdit(...e)),class:"btn-secondary"},"Cancel")])]))])]))),128))]),a.user?((0,n.uX)(),(0,n.CE)("div",be,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.newComment=e),placeholder:"Add a comment...",onKeyup:t[5]||(t[5]=(0,s.jR)((...e)=>r.addComment&&r.addComment(...e),["enter"]))},null,544),[[s.Jo,r.newComment]]),(0,n.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.addComment&&r.addComment(...e)),disabled:!r.newComment.trim()},"Post",8,Re)])):((0,n.uX)(),(0,n.CE)("div",Ee,t[7]||(t[7]=[(0,n.Lk)("p",null,"Please log in to comment.",-1)])))])}const xe={name:"Comments",props:{postId:{type:String,required:!0},postType:{type:String,required:!0},postAuthorId:{type:String,required:!0},user:{type:Object,default:null}},setup(e){const t=(0,Z.KR)([]),a=(0,Z.KR)(""),s=(0,Z.KR)(null),l=(0,Z.KR)("");let r=()=>{};(0,n.sV)(()=>{const a=(0,te.H9)(oe,e.postType,e.postId),s=(0,te.rJ)(a,"comments"),n=(0,te.P)(s,(0,te.My)("createdAt","asc"));r=(0,te.aQ)(n,async e=>{const a=e.docs.map(e=>({id:e.id,...e.data()})),s=[...new Set(a.map(e=>e.userId))];if(s.length>0){const e=new Map;for(let t=0;t<s.length;t+=30){const a=s.slice(t,t+30),n=(0,te.P)((0,te.rJ)(oe,"users"),(0,te._M)((0,te.Fs)(),"in",a)),l=await(0,te.GG)(n);l.forEach(t=>e.set(t.id,t.data()))}t.value=a.map(t=>{const a=e.get(t.userId);return{...t,userName:a?.displayName||t.userName||"Unknown User",userPhoto:a?.photoURL||t.userPhoto||null}})}else t.value=[]})}),(0,n.hi)(()=>{r()});const o=async()=>{if(""===a.value.trim())return;const t=e.user;if(!t)return;const s=(0,te.O5)(),n=(0,te.H9)(oe,e.postType,e.postId),l=(0,te.rJ)(n,"comments"),r=(0,te.H9)(oe,"reviews",e.postId);await Promise.all([(0,te.gS)(l,{userId:t.uid,text:a.value,createdAt:s}),(0,te.mZ)(r,{lastActivityAt:s})]),a.value=""},i=t=>{const a=e.user;return a&&a.uid===t.userId},u=t=>{const a=e.user;return a&&(a.uid===t.userId||a.uid===e.postAuthorId)},d=e=>{s.value=e.id,l.value=e.text},c=()=>{s.value=null,l.value=""},v=async()=>{if(""===l.value.trim()||!s.value)return;const t=(0,te.H9)(oe,e.postType,e.postId),a=(0,te.rJ)(t,"comments"),n=(0,te.H9)(a,s.value),r=(0,te.H9)(oe,"reviews",e.postId);await Promise.all([(0,te.mZ)(n,{text:l.value}),(0,te.mZ)(r,{lastActivityAt:(0,te.O5)()})]),c()},p=async t=>{if(confirm("Are you sure you want to delete this comment?")){const a=(0,te.H9)(oe,e.postType,e.postId),s=(0,te.rJ)(a,"comments"),n=(0,te.H9)(s,t),l=(0,te.H9)(oe,"reviews",e.postId);await Promise.all([(0,te.kd)(n),(0,te.mZ)(l,{lastActivityAt:(0,te.O5)()})])}},g=e=>e&&e.toDate?e.toDate().toLocaleString():"";return{comments:t,newComment:a,addComment:o,canEdit:i,canDelete:u,startEditing:d,cancelEdit:c,saveEdit:v,deleteComment:p,editingCommentId:s,editingText:l,formatDate:g}}};var Ie=a(262);const Xe=(0,Ie.A)(xe,[["render",Me],["__scopeId","data-v-637897c3"]]),_e=Xe,ze=["onClick","onMouseover"],Ae={height:"16px",width:"16px",viewBox:"0 0 24 24",fill:"currentColor"},Ue=["d"];function Se(e,t,a,s,r,o){return(0,n.uX)(),(0,n.CE)("div",{class:(0,l.C4)(["star-rating",{"is-editable":a.editable}])},[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(5,e=>(0,n.Lk)("span",{key:e,onClick:t=>s.setRating(e),onMouseover:t=>s.handleMouseover(e),onMouseleave:t[0]||(t[0]=(...e)=>s.handleMouseleave&&s.handleMouseleave(...e)),class:"star"},[((0,n.uX)(),(0,n.CE)("svg",Ae,[t[1]||(t[1]=(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"},null,-1)),(0,n.Lk)("path",{d:s.getStarPath(e)},null,8,Ue)]))],40,ze)),64))],2)}const Fe={name:"StarRating",props:{rating:{type:Number,required:!0,default:0},editable:{type:Boolean,default:!1}},emits:["update:rating"],setup(e,{emit:t}){const a=(0,Z.KR)(0),s="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z",n="M22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L18.18 21l-1.64-7.03L22 9.24zM12 15.4z",l="M22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z",r=t=>{const r=a.value||e.rating;return r>=t?s:!a.value&&e.rating>=t-.5?n:l},o=a=>{e.editable&&t("update:rating",a)},i=t=>{e.editable&&(a.value=t)},u=()=>{e.editable&&(a.value=0)};return{getStarPath:r,setRating:o,handleMouseover:i,handleMouseleave:u}}},Ke=(0,Ie.A)(Fe,[["render",Se],["__scopeId","data-v-32f96f7e"]]),Pe=Ke;function Ve(e,t,a,s){if(null===e||null===t||null===a||null===s)return null;if(e===a&&t===s)return 0;const n=3959,l=(a-e)*Math.PI/180,r=(s-t)*Math.PI/180,o=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),i=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return n*i}const He={name:"Home",components:{StarRating:Pe,Comments:_e},props:{user:{type:Object,default:null}},setup(e){const t=(0,Z.KR)([]),a=(0,Z.KR)(!0),s=(0,Z.KR)(null),l=(0,Z.KR)(""),r=(0,Z.KR)(null),o=(0,Z.KR)(!1),i=new Map,u=(0,Z.KR)([]),d=10;let c=null;const v=[],p=(0,Z.KR)(new Set),g=(0,Z.KR)(new Map),w=(0,Z.KR)(new Map),k=(0,Z.KR)("time");let m=!1;const h=()=>{i.forEach(e=>{const t=g.value.get(e.userId);e.medal=R(t)});const e=Array.from(i.values()).sort((e,t)=>{if("distance"===k.value&&s.value){const a=e.distance??1/0,s=t.distance??1/0;if(a!==s)return a-s;const n=e.lastActivityAt||e.createdAt,l=t.lastActivityAt||t.createdAt;return l.seconds-n.seconds}const a=e.lastActivityAt||e.createdAt,n=t.lastActivityAt||t.createdAt;return n.seconds-a.seconds});u.value=e,t.value=u.value.slice(0,t.value.length||d)};(0,n.hi)(()=>{v.forEach(e=>e()),c&&c.disconnect()}),(0,n.sV)(()=>{c=new IntersectionObserver(e=>{e[0].isIntersecting&&f()}),C()}),(0,n.wB)(s,e=>{e&&i.size>0&&(i.forEach(t=>{const a=w.value.get(t.restaurantId);t.distance=a?.location?Ve(e.lat,e.lng,a.location.lat,a.location.lng):null}),h())}),(0,n.wB)(()=>e.user,(e,t)=>{e?.uid===t?.uid||m||L()}),(0,n.wB)(r,(e,t)=>{t&&c.unobserve(t),e&&c.observe(e)});const L=async()=>{if(!m){m=!0,a.value=!0;try{v.forEach(e=>{try{e()}catch(t){console.warn("Error unsubscribing listener:",t)}}),v.length=0,i.clear(),await new Promise(e=>setTimeout(e,100));const t=e.user;if(t){const e=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",t.uid)),a=(0,te.aQ)(e,e=>{const t=new Set;e.forEach(e=>t.add(e.data().restaurantId)),p.value=t},e=>{console.error("Error in bucket list listener:",e)});v.push(a)}else p.value.clear();const n=t?(0,te.GG)((0,te.P)((0,te.rJ)(oe,"follows"),(0,te._M)("followerId","==",t.uid))):Promise.resolve({docs:[]}),[l,r,o,u]=await Promise.all([n,(0,te.GG)((0,te.rJ)(oe,"restaurants")),(0,te.GG)((0,te.rJ)(oe,"users")),(0,te.GG)((0,te.P)((0,te.rJ)(oe,"users"),(0,te.My)("reviewCount","desc"),(0,te.AB)(3)))]),d=new Map;u.forEach((e,t)=>{d.set(e.id,t)}),g.value=d,w.value.clear(),r.forEach(e=>{w.value.set(e.id,e.data())});const c=new Map;o.forEach(e=>{c.set(e.id,e.data())});const k=(0,te.P)((0,te.rJ)(oe,"users"),(0,te.My)("reviewCount","desc"),(0,te.AB)(3)),m=(0,te.aQ)(k,e=>{const t=new Map;e.forEach((e,a)=>{t.set(e.id,a)}),g.value=t,h()},e=>{console.error("Error in leaderboard listener:",e)});v.push(m);const L=e=>{e.docChanges().forEach(e=>{if("removed"===e.type)i.delete(e.doc.id);else{const t=e.doc.data(),a=w.value.get(t.restaurantId),n=c.get(t.userId),l=g.value.get(t.userId),r={...t,id:e.doc.id,restaurantName:a?.name||"Unknown Restaurant",restaurantCity:a?.city,restaurantState:a?.state,location:a?.location||null,distance:s.value&&a?.location?Ve(s.value.lat,s.value.lng,a.location.lat,a.location.lng):null,userName:n?.displayName||"Unknown User",userPhoto:n?.photoURL||null,medal:R(l)};i.set(r.id,r)}}),h(),a.value=!1};if(t){const e=l.docs.map(e=>e.data().followingId);if(e.includes(t.uid)||e.push(t.uid),e.length>0)for(let t=0;t<e.length;t+=30){const a=e.slice(t,t+30),s=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","in",a),(0,te.My)("lastActivityAt","desc")),n=(0,te.aQ)(s,L,e=>console.error("Feed error (followed):",e));v.push(n)}if(s.value){const e=[];if(r.forEach(t=>{const a=t.data();if(a.location){const n=Ve(s.value.lat,s.value.lng,a.location.lat,a.location.lng);null!==n&&n<=100&&e.push(t.id)}}),e.length>0)for(let t=0;t<e.length;t+=30){const a=e.slice(t,t+30),s=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("restaurantId","in",a),(0,te.My)("lastActivityAt","desc")),n=(0,te.aQ)(s,L,e=>console.error("Feed error (nearby):",e));v.push(n)}}}else{const e=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te.My)("lastActivityAt","desc"),(0,te.AB)(50)),t=(0,te.aQ)(e,L,e=>console.error("Feed error (recent for guests):",e));v.push(t)}0===v.length&&(a.value=!1)}catch(t){console.error("Error setting up feed listeners:",t),a.value=!1,v.forEach(e=>{try{e()}catch(t){}}),v.length=0}finally{m=!1}}},f=()=>{o.value||t.value.length>=u.value.length||(o.value=!0,setTimeout(()=>{const e=t.value.length,a=u.value.slice(e,e+d);t.value.push(...a),o.value=!1},300))},y=()=>{navigator.geolocation.getCurrentPosition(e=>{l.value="granted",s.value={lat:e.coords.latitude,lng:e.coords.longitude}},()=>{l.value="denied"},{timeout:1e4})},C=async()=>{if(navigator.permissions)try{const e=await navigator.permissions.query({name:"geolocation"});l.value=e.state,e.onchange=()=>{l.value=e.state,"granted"===e.state&&y()},"granted"===e.state&&y()}catch(e){console.error("Error checking location permission:",e),y()}finally{L()}else y()},b=e=>{k.value!==e&&(k.value=e,h())},R=e=>"number"!==typeof e?null:0===e?"ðŸ¥‡":1===e?"ðŸ¥ˆ":2===e?"ðŸ¥‰":null,E=e=>p.value.has(e),M=async t=>{const a=e.user;if(a)if(E(t.restaurantId)){const e=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",a.uid),(0,te._M)("restaurantId","==",t.restaurantId)),s=await(0,te.GG)(e);s.forEach(e=>(0,te.kd)(e.ref))}else await(0,te.gS)((0,te.rJ)(oe,"bucketListItems"),{userId:a.uid,restaurantId:t.restaurantId,createdAt:(0,te.O5)()})};return{posts:t,loading:a,locationPermission:l,requestLocationAccess:y,loadMoreTrigger:r,loadingMore:o,isInBucketList:E,toggleBucketList:M,userLocation:s,sortOrder:k,setSortOrder:b}}},Be=(0,Ie.A)(He,[["render",q],["__scopeId","data-v-fcdac5c0"]]),Qe=Be,Je={class:"restaurants-page"},Te={class:"search-box"},Ge={key:3,class:"add-restaurant-container"},Ne={class:"form-group"},$e={class:"form-group"},De={class:"form-group-row"},We={class:"form-group"},Oe={class:"form-group"},je={class:"form-group"},qe={class:"form-group"},Ze={key:0,class:"error-message"},Ye=["disabled"],et={key:4,class:"leaderboard-container"},tt={class:"leaderboard-list"},at={class:"leaderboard-user"},st={class:"leaderboard-count"},nt={key:5,class:"loading-indicator"},lt={key:6,class:"restaurant-list-container"},rt={key:0,class:"restaurant-list"},ot={class:"restaurant-details"},it={class:"restaurant-name"},ut={class:"restaurant-meta"},dt=["title"],ct={class:"rating-text"},vt={class:"rating-count"},pt={key:1,class:"distance"},gt={class:"restaurant-address"},wt={class:"restaurant-actions"},kt=["onClick","title"],mt=["onClick"],ht=["onClick"],Lt=["href"],ft=["href"],yt=["href"],Ct=["onClick"],bt={key:1,class:"no-restaurants-message"};function Rt(e,t,a,r,o,i){const u=(0,n.g2)("EditRestaurantModal"),d=(0,n.g2)("AddReviewModal"),c=(0,n.g2)("RestaurantReviewsModal"),v=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",Je,[r.isEditModalVisible?((0,n.uX)(),(0,n.Wv)(u,{key:0,restaurant:r.restaurantToEdit,onClose:r.closeEditModal,onSave:r.saveRestaurantChanges},null,8,["restaurant","onClose","onSave"])):(0,n.Q3)("",!0),r.isAddReviewModalVisible?((0,n.uX)(),(0,n.Wv)(d,{key:1,"restaurant-id":r.restaurantIdForNewReview,user:r.user,onClose:r.closeAddReviewModal,onReviewAdded:r.handleReviewAdded},null,8,["restaurant-id","user","onClose","onReviewAdded"])):(0,n.Q3)("",!0),r.isReviewsModalVisible?((0,n.uX)(),(0,n.Wv)(c,{key:2,restaurant:r.restaurantForReviews,user:r.user,onClose:r.closeReviewsModal,onReviewsUpdated:r.handleReviewOrUpdate},null,8,["restaurant","user","onClose","onReviewsUpdated"])):(0,n.Q3)("",!0),(0,n.Lk)("div",Te,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.searchQuery=e),placeholder:"Search by name, address, city, state, or zip...",class:"search-input"},null,512),[[s.Jo,r.searchQuery]])]),r.user?((0,n.uX)(),(0,n.CE)("div",Ge,[(0,n.Lk)("button",{onClick:t[1]||(t[1]=e=>r.showAddForm=!r.showAddForm),class:"btn-toggle-add"},(0,l.v_)(r.showAddForm?"Cancel":"Add New Restaurant"),1),r.showAddForm?((0,n.uX)(),(0,n.CE)("form",{key:0,onSubmit:t[8]||(t[8]=(0,s.D$)((...e)=>r.addNewRestaurant&&r.addNewRestaurant(...e),["prevent"])),class:"add-restaurant-form"},[t[15]||(t[15]=(0,n.Lk)("h3",null,"Add a New Restaurant",-1)),(0,n.Lk)("div",Ne,[t[9]||(t[9]=(0,n.Lk)("label",{for:"new-name"},"Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-name",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.newRestaurant.name=e),required:""},null,512),[[s.Jo,r.newRestaurant.name]])]),(0,n.Lk)("div",$e,[t[10]||(t[10]=(0,n.Lk)("label",{for:"new-address"},"Address",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-address",type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>r.newRestaurant.address=e),required:""},null,512),[[s.Jo,r.newRestaurant.address]])]),(0,n.Lk)("div",De,[(0,n.Lk)("div",We,[t[11]||(t[11]=(0,n.Lk)("label",{for:"new-city"},"City",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-city",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>r.newRestaurant.city=e)},null,512),[[s.Jo,r.newRestaurant.city]])]),(0,n.Lk)("div",Oe,[t[12]||(t[12]=(0,n.Lk)("label",{for:"new-state"},"State",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-state",type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>r.newRestaurant.state=e)},null,512),[[s.Jo,r.newRestaurant.state]])]),(0,n.Lk)("div",je,[t[13]||(t[13]=(0,n.Lk)("label",{for:"new-zip"},"Zip",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-zip",type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>r.newRestaurant.zip=e)},null,512),[[s.Jo,r.newRestaurant.zip]])])]),(0,n.Lk)("div",qe,[t[14]||(t[14]=(0,n.Lk)("label",{for:"new-url"},"Website URL",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-url",type:"url","onUpdate:modelValue":t[7]||(t[7]=e=>r.newRestaurant.url=e),placeholder:"https://example.com"},null,512),[[s.Jo,r.newRestaurant.url]])]),r.addError?((0,n.uX)(),(0,n.CE)("p",Ze,(0,l.v_)(r.addError),1)):(0,n.Q3)("",!0),(0,n.Lk)("button",{type:"submit",disabled:r.isSaving,class:"btn-save"},(0,l.v_)(r.isSaving?"Saving...":"Save Restaurant"),9,Ye)],32)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),r.userLeaderboard.length>0?((0,n.uX)(),(0,n.CE)("div",et,[t[16]||(t[16]=(0,n.Lk)("h3",null,"Top Reviewers",-1)),(0,n.Lk)("ol",tt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.userLeaderboard.slice(0,5),e=>((0,n.uX)(),(0,n.CE)("li",{key:e.userId},[(0,n.Lk)("span",at,(0,l.v_)(e.displayName),1),(0,n.Lk)("span",st,(0,l.v_)(e.postCount)+" "+(0,l.v_)(1===e.postCount?"review":"reviews"),1)]))),128))])])):(0,n.Q3)("",!0),r.loading?((0,n.uX)(),(0,n.CE)("div",nt,"Loading restaurants...")):((0,n.uX)(),(0,n.CE)("div",lt,[r.filteredRestaurants.length>0?((0,n.uX)(),(0,n.CE)("ul",rt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.filteredRestaurants,e=>((0,n.uX)(),(0,n.CE)("li",{key:e.id,class:"restaurant-item"},[(0,n.Lk)("div",ot,[(0,n.Lk)("span",it,(0,l.v_)(e.name),1),(0,n.Lk)("div",ut,[e.averageRating>0?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rating",title:`${e.averageRating.toFixed(2)} average rating`},[(0,n.bF)(v,{rating:e.averageRating},null,8,["rating"]),(0,n.Lk)("span",ct,(0,l.v_)(e.averageRating.toFixed(1)),1),(0,n.Lk)("span",vt,"("+(0,l.v_)(e.ratingCount)+")",1)],8,dt)):(0,n.Q3)("",!0),null!==e.distance?((0,n.uX)(),(0,n.CE)("span",pt,(0,l.v_)(e.distance.toFixed(1))+" miles away ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",gt,[(0,n.eW)((0,l.v_)(e.address),1),e.city?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.eW)(", "+(0,l.v_)(e.city),1)],64)):(0,n.Q3)("",!0),e.state?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)(", "+(0,l.v_)(e.state),1)],64)):(0,n.Q3)("",!0),e.zip?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.eW)((0,l.v_)(e.zip),1)],64)):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",wt,[r.user?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:t=>r.toggleBucketList(e),class:(0,l.C4)(["action-btn",{"in-bucket-list":r.isInBucketList(e.id)}]),title:r.isInBucketList(e.id)?"Remove from Bucket List":"Add to Bucket List"},t[17]||(t[17]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M18 7h-2.06c-.33-3.2-2.46-5.8-5.94-5.8S4.39 3.8 4.06 7H2v12h16V7zM6.14 7c.2-1.92 1.6-3.48 3.86-3.8A4.002 4.002 0 0 1 14 7h-2.14c-.2-1.92-1.6-3.48-3.86-3.8zM16 17H4v-8h12v8z"})],-1)]),10,kt)):(0,n.Q3)("",!0),(0,n.Lk)("button",{onClick:t=>r.openReviewsModal(e),class:"action-btn",title:"View Reviews"},t[18]||(t[18]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})],-1)]),8,mt),r.user?((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:t=>r.openEditModal(e),class:"action-btn",title:"Edit Restaurant"},t[19]||(t[19]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})],-1)]),8,ht)):(0,n.Q3)("",!0),(0,n.Lk)("a",{href:r.getDirectionsUrl(e),target:"_blank",rel:"noopener noreferrer",class:"action-btn",title:"Get Directions"},t[20]||(t[20]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M22.43 10.59l-9.01-9.01c-.75-.75-2.07-.76-2.83 0l-9.01 9.01c-.76.75-.76 2.07 0 2.83l9.01 9.01c.75.75 2.07.75 2.83 0l9.01-9.01c.75-.76.75-2.08 0-2.83zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"})],-1)]),8,Lt),(0,n.Lk)("a",{href:r.getDetailsUrl(e),target:"_blank",rel:"noopener noreferrer",class:"action-btn",title:"View Details on Google"},t[21]||(t[21]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.41-1.41L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1)]),8,ft),e.url?((0,n.uX)(),(0,n.CE)("a",{key:2,href:r.getValidUrl(e.url),target:"_blank",rel:"noopener noreferrer",class:"action-btn",title:"Visit Website"},t[22]||(t[22]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})],-1)]),8,yt)):(0,n.Q3)("",!0),r.user?((0,n.uX)(),(0,n.CE)("button",{key:3,class:"check-in-btn",onClick:t=>r.openAddReviewModal(e.id)},"Review",8,Ct)):(0,n.Q3)("",!0)])]))),128))])):((0,n.uX)(),(0,n.CE)("p",bt,"No restaurants found matching your search."))]))])}const Et={class:"modal-content"},Mt={class:"form-group"},xt={class:"form-group"},It={class:"form-group"},Xt={class:"form-group"},_t={class:"form-group"},zt={class:"form-group"},At={class:"modal-actions"};function Ut(e,t,a,l,r,o){return(0,n.uX)(),(0,n.CE)("div",{class:"modal-overlay",onClick:t[8]||(t[8]=(0,s.D$)(t=>e.$emit("close"),["self"]))},[(0,n.Lk)("div",Et,[t[16]||(t[16]=(0,n.Lk)("h2",null,"Edit Restaurant",-1)),l.editableRestaurant?((0,n.uX)(),(0,n.CE)("form",{key:0,onSubmit:t[7]||(t[7]=(0,s.D$)((...e)=>l.onSave&&l.onSave(...e),["prevent"]))},[(0,n.Lk)("div",Mt,[t[9]||(t[9]=(0,n.Lk)("label",{for:"name"},"Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>l.editableRestaurant.name=e),type:"text",required:""},null,512),[[s.Jo,l.editableRestaurant.name]])]),(0,n.Lk)("div",xt,[t[10]||(t[10]=(0,n.Lk)("label",{for:"address"},"Address",-1)),(0,n.bo)((0,n.Lk)("input",{id:"address","onUpdate:modelValue":t[1]||(t[1]=e=>l.editableRestaurant.address=e),type:"text"},null,512),[[s.Jo,l.editableRestaurant.address]])]),(0,n.Lk)("div",It,[t[11]||(t[11]=(0,n.Lk)("label",{for:"city"},"City",-1)),(0,n.bo)((0,n.Lk)("input",{id:"city","onUpdate:modelValue":t[2]||(t[2]=e=>l.editableRestaurant.city=e),type:"text"},null,512),[[s.Jo,l.editableRestaurant.city]])]),(0,n.Lk)("div",Xt,[t[12]||(t[12]=(0,n.Lk)("label",{for:"state"},"State",-1)),(0,n.bo)((0,n.Lk)("input",{id:"state","onUpdate:modelValue":t[3]||(t[3]=e=>l.editableRestaurant.state=e),type:"text"},null,512),[[s.Jo,l.editableRestaurant.state]])]),(0,n.Lk)("div",_t,[t[13]||(t[13]=(0,n.Lk)("label",{for:"zip"},"Zip Code",-1)),(0,n.bo)((0,n.Lk)("input",{id:"zip","onUpdate:modelValue":t[4]||(t[4]=e=>l.editableRestaurant.zip=e),type:"text"},null,512),[[s.Jo,l.editableRestaurant.zip]])]),(0,n.Lk)("div",zt,[t[14]||(t[14]=(0,n.Lk)("label",{for:"url"},"Website URL",-1)),(0,n.bo)((0,n.Lk)("input",{id:"url","onUpdate:modelValue":t[5]||(t[5]=e=>l.editableRestaurant.url=e),type:"url",placeholder:"https://example.com"},null,512),[[s.Jo,l.editableRestaurant.url]])]),(0,n.Lk)("div",At,[(0,n.Lk)("button",{type:"button",class:"btn-cancel",onClick:t[6]||(t[6]=t=>e.$emit("close"))},"Cancel"),t[15]||(t[15]=(0,n.Lk)("button",{type:"submit",class:"btn-save"},"Save Changes",-1))])],32)):(0,n.Q3)("",!0)])])}const St={name:"EditRestaurantModal",props:{restaurant:{type:Object,required:!0}},emits:["close","save"],setup(e,{emit:t}){const a=(0,Z.KR)(null);(0,n.wB)(()=>e.restaurant,e=>{e&&(a.value=JSON.parse(JSON.stringify(e)))},{immediate:!0,deep:!0});const s=()=>{t("save",a.value)};return{editableRestaurant:a,onSave:s}}},Ft=(0,Ie.A)(St,[["render",Ut],["__scopeId","data-v-2288406c"]]),Kt=Ft,Pt={class:"modal-content"},Vt={class:"modal-header"},Ht=["disabled"],Bt={class:"modal-body"},Qt={class:"form-group"},Jt={class:"form-group"},Tt={class:"form-group"},Gt={key:0,class:"photo-preview-container"},Nt=["src"],$t={key:0,class:"upload-progress"},Dt=["value"],Wt={key:1,class:"error-message"},Ot={class:"form-actions"},jt=["disabled"];function qt(e,t,a,r,o,i){const u=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",{class:"modal-overlay",onClick:t[5]||(t[5]=(0,s.D$)(t=>e.$emit("close"),["self"]))},[(0,n.Lk)("div",Pt,[(0,n.Lk)("div",Vt,[t[6]||(t[6]=(0,n.Lk)("h2",null,"Add Your Review",-1)),(0,n.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn",disabled:r.isUploading},"Ã—",8,Ht)]),(0,n.Lk)("div",Bt,[(0,n.Lk)("form",{onSubmit:t[4]||(t[4]=(0,s.D$)((...e)=>r.submitReview&&r.submitReview(...e),["prevent"]))},[(0,n.Lk)("div",Qt,[t[7]||(t[7]=(0,n.Lk)("label",null,"Your Rating",-1)),(0,n.bF)(u,{rating:r.review.rating,editable:!0,"onUpdate:rating":t[1]||(t[1]=e=>r.review.rating=e)},null,8,["rating"])]),(0,n.Lk)("div",Jt,[t[8]||(t[8]=(0,n.Lk)("label",{for:"review-text"},"Your Review",-1)),(0,n.bo)((0,n.Lk)("textarea",{id:"review-text","onUpdate:modelValue":t[2]||(t[2]=e=>r.review.text=e),placeholder:"What did you think?"},null,512),[[s.Jo,r.review.text]])]),(0,n.Lk)("div",Tt,[t[9]||(t[9]=(0,n.Lk)("label",{for:"review-photo"},"Add a Photo",-1)),(0,n.Lk)("input",{type:"file",id:"review-photo",onChange:t[3]||(t[3]=(...e)=>r.handleFileChange&&r.handleFileChange(...e)),accept:"image/*"},null,32),r.photoPreview?((0,n.uX)(),(0,n.CE)("div",Gt,[(0,n.Lk)("img",{src:r.photoPreview,alt:"Photo preview",class:"photo-preview"},null,8,Nt)])):(0,n.Q3)("",!0)]),r.isUploading?((0,n.uX)(),(0,n.CE)("div",$t,[(0,n.Lk)("p",null,"Uploading... "+(0,l.v_)(r.uploadProgress.toFixed(0))+"%",1),(0,n.Lk)("progress",{value:r.uploadProgress,max:"100"},null,8,Dt)])):(0,n.Q3)("",!0),r.error?((0,n.uX)(),(0,n.CE)("div",Wt,(0,l.v_)(r.error),1)):(0,n.Q3)("",!0),(0,n.Lk)("div",Ot,[(0,n.Lk)("button",{type:"submit",class:"btn-primary",disabled:r.isUploading||0===r.review.rating},(0,l.v_)(r.isUploading?"Submitting...":"Submit Review"),9,jt)])],32)])])])}const Zt={name:"AddReviewModal",components:{StarRating:Pe},props:{restaurantId:{type:String,required:!0},user:{type:Object,required:!0}},emits:["close","review-added"],setup(e,{emit:t}){const a=(0,Z.KR)({rating:0,text:""}),s=(0,Z.KR)(null),n=(0,Z.KR)(null),l=(0,Z.KR)(!1),r=(0,Z.KR)(0),o=(0,Z.KR)(""),i=e=>{const t=e.target.files[0];if(!t)return s.value=null,void(n.value=null);if(!t.type.startsWith("image/"))return void(o.value="Please select an image file.");n.value=URL.createObjectURL(t);const a=new FileReader;a.onload=e=>{const a=new Image;a.onload=()=>{const e=1024;let{width:n,height:l}=a;n>l?n>e&&(l*=e/n,n=e):l>e&&(n*=e/l,l=e);const r=document.createElement("canvas");r.width=n,r.height=l;const o=r.getContext("2d");o.drawImage(a,0,0,n,l),r.toBlob(e=>{s.value=e},t.type,.9)},a.src=e.target.result},a.readAsDataURL(t)},u=async()=>{if(0!==a.value.rating){l.value=!0,o.value="";try{let n=null;if(s.value){const t=`reviews/${e.restaurantId}/${Date.now()}_${e.user.uid}`,a=(0,ae.KR)(ie,t),i=(0,ae.bp)(a,s.value);await new Promise((e,t)=>{i.on("state_changed",e=>{r.value=e.bytesTransferred/e.totalBytes*100},e=>{console.error("Upload failed:",e),o.value="Image upload failed. Please try again.",l.value=!1,t(e)},async()=>{n=await(0,ae.qk)(i.snapshot.ref),e()})})}const i={userId:e.user.uid,userName:e.user.displayName||"Anonymous",userPhoto:e.user.photoURL,restaurantId:e.restaurantId,rating:a.value.rating,text:a.value.text,photoURL:n,createdAt:(0,te.O5)()};await(0,te.gS)((0,te.rJ)(oe,"reviews"),i);const u=(0,te.H9)(oe,"users",e.user.uid);await(0,te.mZ)(u,{reviewCount:(0,te.GV)(1)}),t("review-added",e.restaurantId)}catch(n){o.value||(console.error("Error submitting review:",n),o.value="Failed to submit review. Please try again."),l.value=!1}}else o.value="Please provide a star rating."};return{review:a,photoPreview:n,isUploading:l,uploadProgress:r,error:o,handleFileChange:i,submitReview:u}}},Yt=(0,Ie.A)(Zt,[["render",qt],["__scopeId","data-v-f0fb81b8"]]),ea=Yt,ta={class:"modal-content"},aa={class:"modal-header"},sa={class:"modal-body"},na={key:0,class:"no-reviews-message"},la={key:1,class:"reviews-list"},ra={key:0},oa={class:"edit-review-form"},ia={class:"edit-actions"},ua={key:1},da={class:"review-header"},ca=["src"],va={class:"user-info"},pa={class:"user-name"},ga={class:"review-date"},wa={key:0,class:"review-actions"},ka=["onClick"],ma=["onClick"],ha={class:"review-body"},La={key:0,class:"review-text"},fa={key:1,class:"review-photo-container"},ya=["src"],Ca={key:2,class:"tags-container"};function ba(e,t,a,r,o,i){const u=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",{class:"modal-overlay",onClick:t[5]||(t[5]=(0,s.D$)(t=>e.$emit("close"),["self"]))},[(0,n.Lk)("div",ta,[(0,n.Lk)("div",aa,[(0,n.Lk)("h2",null,"Reviews for "+(0,l.v_)(a.restaurant.name),1),(0,n.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},"Ã—")]),(0,n.Lk)("div",sa,[a.restaurant.reviews&&0===a.restaurant.reviews.length?((0,n.uX)(),(0,n.CE)("div",na," No reviews yet for this restaurant. ")):((0,n.uX)(),(0,n.CE)("ul",la,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.restaurant.reviews,e=>((0,n.uX)(),(0,n.CE)("li",{key:e.id,class:"review-item"},[r.editingReview&&r.editingReview.id===e.id?((0,n.uX)(),(0,n.CE)("div",ra,[(0,n.Lk)("div",oa,[(0,n.bF)(u,{rating:r.editingReview.rating,editable:!0,"onUpdate:rating":t[1]||(t[1]=e=>r.editingReview.rating=e)},null,8,["rating"]),(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.editingReview.text=e),class:"edit-textarea"},null,512),[[s.Jo,r.editingReview.text]]),(0,n.Lk)("div",ia,[(0,n.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.saveEdit&&r.saveEdit(...e)),class:"btn-primary"},"Save"),(0,n.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.cancelEdit&&r.cancelEdit(...e)),class:"btn-secondary"},"Cancel")])])])):((0,n.uX)(),(0,n.CE)("div",ua,[(0,n.Lk)("div",da,[(0,n.Lk)("img",{src:e.userPhoto||"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"User",class:"user-avatar"},null,8,ca),(0,n.Lk)("div",va,[(0,n.Lk)("span",pa,(0,l.v_)(e.userName),1),(0,n.Lk)("span",ga,(0,l.v_)(r.formatDate(e.createdAt)),1)]),a.user&&a.user.uid===e.userId?((0,n.uX)(),(0,n.CE)("div",wa,[(0,n.Lk)("button",{onClick:t=>r.startEditing(e),class:"action-btn",title:"Edit Review"},t[6]||(t[6]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"18px",viewBox:"0 0 24 24",width:"18px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})],-1)]),8,ka),(0,n.Lk)("button",{onClick:t=>r.deleteReview(e.id),class:"action-btn",title:"Delete Review"},t[7]||(t[7]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"18px",viewBox:"0 0 24 24",width:"18px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)]),8,ma)])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",ha,[(0,n.bF)(u,{rating:e.rating},null,8,["rating"]),e.text?((0,n.uX)(),(0,n.CE)("p",La,'"'+(0,l.v_)(e.text)+'"',1)):(0,n.Q3)("",!0),e.photoURL?((0,n.uX)(),(0,n.CE)("div",fa,[(0,n.Lk)("img",{src:e.photoURL,alt:"Review photo",class:"review-photo"},null,8,ya)])):(0,n.Q3)("",!0),e.tags&&e.tags.length>0?((0,n.uX)(),(0,n.CE)("div",Ca,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.tags,e=>((0,n.uX)(),(0,n.CE)("span",{key:e,class:"tag"},(0,l.v_)(e),1))),128))])):(0,n.Q3)("",!0)])]))]))),128))]))])])])}const Ra={name:"RestaurantReviewsModal",components:{StarRating:Pe},props:{restaurant:{type:Object,required:!0},user:{type:Object,default:null}},emits:["close","reviews-updated"],setup(e,{emit:t}){const a=(0,Z.KR)(null),s=e=>e&&e.toDate?e.toDate().toLocaleDateString():"",n=e=>{a.value=JSON.parse(JSON.stringify(e))},l=()=>{a.value=null},r=async()=>{if(!a.value)return;const e=(0,te.H9)(oe,"reviews",a.value.id);try{await(0,te.mZ)(e,{rating:a.value.rating,text:a.value.text}),t("reviews-updated"),l()}catch(s){console.error("Error updating review:",s),alert("Failed to save review. Please try again.")}},o=async e=>{if(confirm("Are you sure you want to delete this review?"))try{await(0,te.kd)((0,te.H9)(oe,"reviews",e)),t("reviews-updated")}catch(a){console.error("Error deleting review:",a),alert("Failed to delete review. Please try again.")}};return{formatDate:s,editingReview:a,startEditing:n,cancelEdit:l,saveEdit:r,deleteReview:o}}},Ea=(0,Ie.A)(Ra,[["render",ba],["__scopeId","data-v-0ea2250e"]]),Ma=Ea,xa={name:"Restaurants",components:{EditRestaurantModal:Kt,StarRating:Pe,RestaurantReviewsModal:Ma,AddReviewModal:ea},props:{user:{type:Object,default:null}},setup(e){const t=(0,Z.KR)([]),s=(0,Z.KR)([]),l=(0,Z.KR)(!0),r=(0,Z.KR)(""),o=(0,Z.KR)(!1),i=(0,Z.KR)(!1),u=(0,Z.KR)(!1),d=(0,Z.KR)(null),c=(0,Z.KR)(null),v=(0,Z.KR)(null),p=(0,Z.KR)(null),g=(0,Z.KR)(new Set),w=(0,Z.KR)(!1),k=(0,Z.KR)({name:"",address:"",city:"",state:"",zip:"",url:""}),m=(0,Z.KR)(""),h=(0,Z.KR)(!1);let L=()=>{},f=()=>{},y=()=>{};const C=(0,n.EW)(()=>{const e={};return s.value.forEach(t=>{t.restaurantId&&"number"===typeof t.rating&&(e[t.restaurantId]||(e[t.restaurantId]={total:0,count:0,reviews:[]}),e[t.restaurantId].total+=t.rating,e[t.restaurantId].count++,e[t.restaurantId].reviews.push(t))}),t.value.map(t=>{const a=e[t.id],s=a?a.reviews.sort((e,t)=>(t.createdAt?.seconds??0)-(e.createdAt?.seconds??0)):[];return{...t,averageRating:a?a.total/a.count:0,ratingCount:a?a.count:0,reviews:s}})}),b=(0,n.EW)(()=>{if(!s.value.length)return[];const e=s.value.reduce((e,t)=>(t.userId&&(e[t.userId]||(e[t.userId]={userId:t.userId,displayName:t.userName||"Anonymous",postCount:0}),e[t.userId].postCount++),e),{});return Object.values(e).sort((e,t)=>t.postCount-e.postCount)});(0,n.sV)(()=>{l.value=!0;const e=(0,te.rJ)(oe,"restaurants");f=(0,te.aQ)(e,e=>{t.value=e.docs.map(e=>({id:e.id,...e.data()})),s.value.length>0&&(l.value=!1)},e=>{console.error("Error fetching restaurants:",e),l.value=!1});const a=(0,te.rJ)(oe,"reviews");y=(0,te.aQ)(a,e=>{s.value=e.docs.map(e=>({id:e.id,...e.data()})),l.value=!1},e=>{console.error("Error fetching reviews:",e),l.value=!1}),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{p.value={lat:e.coords.latitude,lng:e.coords.longitude}},e=>{console.error("Error getting location",e)}):console.error("Geolocation is not supported by this browser.")}),(0,n.hi)(()=>{L(),f(),y()});const R=e=>{L();const t=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",e));L=(0,te.aQ)(t,e=>{const t=new Set;e.forEach(e=>t.add(e.data().restaurantId)),g.value=t})};(0,n.wB)(()=>e.user,e=>{e?R(e.uid):(L(),g.value.clear())},{immediate:!0});const E=(0,n.EW)(()=>C.value.map(e=>{const t=p.value&&e.location?Ve(p.value.lat,p.value.lng,e.location.lat,e.location.lng):null;return{...e,distance:t}}).sort((e,t)=>null===e.distance?1:null===t.distance?-1:e.distance-t.distance)),M=(0,n.EW)(()=>{if(!r.value.trim())return E.value;const e=r.value.toLowerCase();return E.value.filter(t=>t.name&&t.name.toLowerCase().includes(e)||t.address&&t.address.toLowerCase().includes(e)||t.city&&t.city.toLowerCase().includes(e)||t.state&&t.state.toLowerCase().includes(e)||t.zip&&t.zip.toLowerCase().includes(e))}),x=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/maps/dir/?api=1&destination=${t}`},I=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/search?q=${t}`},X=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:`https://${e}`:"#",_=e=>{d.value=e,o.value=!0},z=()=>{o.value=!1,d.value=null},A=e=>{v.value=e,u.value=!0},U=()=>{u.value=!1,v.value=null},S=e=>{c.value=e,i.value=!0},F=()=>{i.value=!1,c.value=null},K=async e=>{F()},P=async()=>{},V=async e=>{const t={...e};if(!t||!t.id)return;const s=d.value,n={},l=s.name!==t.name;l&&(n.name=t.name,n.name_lowercase=t.name.trim().toLowerCase());const r=["address","city","state","zip"],o=r.some(e=>s[e]!==t[e]);if(o){n.address=t.address,n.city=t.city,n.state=t.state,n.zip=t.zip,n.address_lowercase=(t.address||"").trim().toLowerCase();const e=[t.address,t.city,t.state,t.zip].filter(Boolean).join(", "),{geocodeAddress:s}=await Promise.resolve().then(a.bind(a,914)),l=await s(e);l?n.location=l:(alert("Could not find a location for the provided address. Please check the address and try again. The restaurant will be saved without a location."),n.location=null)}if(s.url!==t.url&&(n.url=t.url),0===Object.keys(n).length)return void z();const i=(0,te.H9)(oe,"restaurants",t.id);try{await(0,te.mZ)(i,n),z()}catch(u){console.error("Error updating restaurant: ",u),alert("Failed to save changes. Please try again.")}},H=async()=>{if(!e.user)return void(m.value="You must be logged in to add a restaurant.");if(!k.value.name.trim()||!k.value.address.trim())return void(m.value="Restaurant name and address are required.");h.value=!0,m.value="";const t=k.value.name.trim().toLowerCase(),s=k.value.address.trim().toLowerCase();try{const n=(0,te.P)((0,te.rJ)(oe,"restaurants"),(0,te._M)("name_lowercase","==",t),(0,te._M)("address_lowercase","==",s)),l=await(0,te.GG)(n);if(!l.empty)return m.value="This restaurant already exists.",void(h.value=!1);const r=[k.value.address,k.value.city,k.value.state,k.value.zip].filter(Boolean).join(", "),{geocodeAddress:o}=await Promise.resolve().then(a.bind(a,914)),i=await o(r);if(!i)return m.value="Could not find a location for the provided address. Please check the address and try again.",void(h.value=!1);const u={name:k.value.name.trim(),address:k.value.address.trim(),city:k.value.city.trim(),state:k.value.state.trim(),zip:k.value.zip.trim(),url:k.value.url.trim(),name_lowercase:t,address_lowercase:s,location:i,createdAt:(0,te.O5)(),userId:e.user.uid,userDisplayName:e.user.displayName||"Anonymous"};await(0,te.gS)((0,te.rJ)(oe,"restaurants"),u);w.value=!1,k.value={name:"",address:"",city:"",state:"",zip:"",url:""}}catch(n){console.error("Error adding new restaurant:",n),m.value="Failed to add restaurant. Please try again."}finally{h.value=!1}},B=e=>g.value.has(e),Q=async t=>{const a=e.user;if(a)if(B(t.id)){const e=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",a.uid),(0,te._M)("restaurantId","==",t.id)),s=await(0,te.GG)(e);s.forEach(e=>(0,te.kd)(e.ref))}else await(0,te.gS)((0,te.rJ)(oe,"bucketListItems"),{userId:a.uid,restaurantId:t.id,createdAt:(0,te.O5)()})};return{user:e.user,loading:l,searchQuery:r,filteredRestaurants:M,getDirectionsUrl:x,getDetailsUrl:I,getValidUrl:X,isEditModalVisible:o,restaurantToEdit:d,isReviewsModalVisible:u,restaurantForReviews:v,openEditModal:_,closeEditModal:z,saveRestaurantChanges:V,openReviewsModal:A,closeReviewsModal:U,handleReviewOrUpdate:P,isInBucketList:B,toggleBucketList:Q,showAddForm:w,newRestaurant:k,addNewRestaurant:H,addError:m,isSaving:h,isAddReviewModalVisible:i,restaurantIdForNewReview:c,openAddReviewModal:S,closeAddReviewModal:F,handleReviewAdded:K,userLeaderboard:b}}},Ia=(0,Ie.A)(xa,[["render",Rt],["__scopeId","data-v-1e94dd4f"]]),Xa=Ia,_a={class:"user-search-page"},za={class:"search-box"},Aa={key:0},Ua={key:1},Sa={key:0,class:"no-users-message"},Fa={key:0},Ka={key:1},Pa={class:"user-card-content"},Va={class:"user-info"},Ha=["src"],Ba={class:"user-details"},Qa={class:"user-name"},Ja={key:0,class:"user-distance"},Ta={key:0,class:"last-review"},Ga={class:"review-header"},Na={class:"review-body"},$a={key:0,class:"review-text"},Da={key:1,class:"last-review no-review"},Wa={class:"user-actions"},Oa=["onClick"],ja=["onClick"];function qa(e,t,a,r,o,i){const u=(0,n.g2)("UserReviewsModal"),d=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)(n.FK,null,[r.isReviewsModalVisible?((0,n.uX)(),(0,n.Wv)(u,{key:0,user:r.userForReviews,onClose:r.closeReviewsModal},null,8,["user","onClose"])):(0,n.Q3)("",!0),(0,n.Lk)("div",_a,[(0,n.Lk)("div",za,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.searchQuery=e),placeholder:"Search for users by name...",class:"search-input"},null,512),[[s.Jo,r.searchQuery]])]),r.loading?((0,n.uX)(),(0,n.CE)("div",Aa,"Loading users...")):((0,n.uX)(),(0,n.CE)("div",Ua,[0===r.filteredUsers.length?((0,n.uX)(),(0,n.CE)("div",Sa,[r.searchQuery?((0,n.uX)(),(0,n.CE)("span",Fa,"No users found matching your search.")):((0,n.uX)(),(0,n.CE)("span",Ka,"No other users found."))])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.filteredUsers,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.uid,class:"user-card"},[(0,n.Lk)("div",Pa,[(0,n.Lk)("div",Va,[(0,n.Lk)("img",{src:e.photoURL||"https://cdn-icons-png.flaticon.com/512/149/149071.png",class:"user-avatar",alt:"User"},null,8,Ha),(0,n.Lk)("div",Ba,[(0,n.Lk)("span",Qa,(0,l.v_)(e.displayName),1),null!==e.distance?((0,n.uX)(),(0,n.CE)("div",Ja,(0,l.v_)(e.distance.toFixed(1))+" miles away",1)):(0,n.Q3)("",!0)])]),e.lastReview?((0,n.uX)(),(0,n.CE)("div",Ta,[(0,n.Lk)("div",Ga,[t[1]||(t[1]=(0,n.eW)(" Latest review: ",-1)),(0,n.Lk)("strong",null,(0,l.v_)(e.lastReview.restaurantName),1)]),(0,n.Lk)("div",Na,[(0,n.bF)(d,{rating:e.lastReview.rating},null,8,["rating"]),e.lastReview.text?((0,n.uX)(),(0,n.CE)("p",$a,'"'+(0,l.v_)(e.lastReview.text)+'"',1)):(0,n.Q3)("",!0)])])):((0,n.uX)(),(0,n.CE)("div",Da," No reviews yet. "))]),(0,n.Lk)("div",Wa,[(0,n.Lk)("button",{onClick:t=>r.openReviewsModal(e),class:"action-btn",title:"View Reviews"},t[2]||(t[2]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})],-1)]),8,Oa),(0,n.Lk)("button",{onClick:t=>r.toggleFollow(e),class:(0,l.C4)(["follow-btn",{"unfollow-btn":e.isFollowing}])},(0,l.v_)(e.isFollowing?"Unfollow":"Follow"),11,ja)])]))),128))]))])],64)}const Za={class:"modal-content"},Ya={class:"modal-header"},es={class:"modal-body"},ts={key:0,class:"loading-indicator"},as={key:1,class:"no-reviews-message"},ss={key:2,class:"reviews-list"},ns={class:"review-header"},ls={class:"restaurant-name"},rs={class:"review-date"},os={class:"review-body"},is={key:0,class:"review-text"},us=["src"],ds={key:2,class:"tags-container"};function cs(e,t,a,r,o,i){const u=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",{class:"modal-overlay",onClick:t[1]||(t[1]=(0,s.D$)(t=>e.$emit("close"),["self"]))},[(0,n.Lk)("div",Za,[(0,n.Lk)("div",Ya,[(0,n.Lk)("h2",null,"Reviews by "+(0,l.v_)(a.user.displayName),1),(0,n.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},"Ã—")]),(0,n.Lk)("div",es,[r.loading?((0,n.uX)(),(0,n.CE)("div",ts,"Loading reviews...")):0===r.reviews.length?((0,n.uX)(),(0,n.CE)("p",as," This user hasn't posted any reviews yet. ")):((0,n.uX)(),(0,n.CE)("ul",ss,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.reviews,e=>((0,n.uX)(),(0,n.CE)("li",{key:e.id,class:"review-item"},[(0,n.Lk)("div",ns,[(0,n.Lk)("span",ls,(0,l.v_)(e.restaurantName),1),(0,n.Lk)("span",rs,(0,l.v_)(r.formatDate(e.createdAt)),1)]),(0,n.Lk)("div",os,[(0,n.bF)(u,{rating:e.rating},null,8,["rating"]),e.text?((0,n.uX)(),(0,n.CE)("p",is,'"'+(0,l.v_)(e.text)+'"',1)):(0,n.Q3)("",!0),e.photoURL?((0,n.uX)(),(0,n.CE)("img",{key:1,src:e.photoURL,alt:"Review photo",class:"review-photo"},null,8,us)):(0,n.Q3)("",!0),e.tags&&e.tags.length>0?((0,n.uX)(),(0,n.CE)("div",ds,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.tags,e=>((0,n.uX)(),(0,n.CE)("span",{key:e,class:"tag"},(0,l.v_)(e),1))),128))])):(0,n.Q3)("",!0)])]))),128))]))])])])}const vs={name:"UserReviewsModal",components:{StarRating:Pe},props:{user:{type:Object,required:!0}},emits:["close"],setup(e){const t=(0,Z.KR)([]),a=(0,Z.KR)(!0),s=async()=>{if(!e.user?.uid)return t.value=[],void(a.value=!1);a.value=!0,t.value=[];try{const a=await(0,te.GG)((0,te.rJ)(oe,"restaurants")),s=new Map;a.forEach(e=>{s.set(e.id,e.data().name)});const n=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","==",e.user.uid),(0,te.My)("createdAt","desc")),l=await(0,te.GG)(n);t.value=l.docs.map(e=>{const t=e.data();return{id:e.id,...t,restaurantName:s.get(t.restaurantId)||"Unknown Restaurant"}})}catch(s){console.error("Error fetching user reviews:",s)}finally{a.value=!1}};(0,n.wB)(()=>e.user,e=>{e&&s()},{immediate:!0});const l=e=>e&&e.toDate?e.toDate().toLocaleDateString():"";return{reviews:t,loading:a,formatDate:l}}},ps=(0,Ie.A)(vs,[["render",cs],["__scopeId","data-v-4e60c4e2"]]),gs=ps,ws={name:"UserSearch",components:{StarRating:Pe,UserReviewsModal:gs},setup(){const e=(0,Z.KR)([]),t=(0,Z.KR)(!0),a=(0,Z.KR)(null),s=(0,Z.KR)([]),l=(0,Z.KR)(""),r=(0,Z.KR)(!1),o=(0,Z.KR)(null);let i=()=>{};const u=async()=>{t.value=!0;const n=le.currentUser;if(!n)return;const l=(0,te.P)((0,te.rJ)(oe,"follows"),(0,te._M)("followerId","==",n.uid));i=(0,te.aQ)(l,t=>{const a=t.docs.map(e=>e.data().followingId);s.value=a,e.value=e.value.map(e=>({...e,isFollowing:a.includes(e.uid)}))});const r=await(0,te.GG)((0,te.rJ)(oe,"restaurants")),o=new Map;r.forEach(e=>{o.set(e.id,e.data())});const u=(0,te.P)((0,te.rJ)(oe,"users"),(0,te._M)("uid","!=",n.uid)),d=await(0,te.GG)(u),c=d.docs.map(e=>({uid:e.id,...e.data()})),v=await Promise.all(c.map(async e=>{const t=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","==",e.uid),(0,te.My)("createdAt","desc"),(0,te.AB)(1)),n=await(0,te.GG)(t);let l=null,r=null;if(!n.empty){const e=n.docs[0].data(),t=o.get(e.restaurantId);l={...e,restaurantName:t?.name||"Unknown Restaurant"},a.value&&t?.location&&(r=Ve(a.value.lat,a.value.lng,t.location.lat,t.location.lng))}return{...e,isFollowing:s.value.includes(e.uid),lastReview:l,distance:r}}));e.value=v,t.value=!1};(0,n.sV)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{a.value={lat:e.coords.latitude,lng:e.coords.longitude},u()},e=>{console.error("Error getting location",e),u()}):(console.error("Geolocation is not supported by this browser."),u())}),(0,n.hi)(()=>{i()});const d=(0,n.EW)(()=>{const t=[...e.value].sort((e,t)=>null===e.distance&&null!==t.distance?1:null!==e.distance&&null===t.distance?-1:null===e.distance&&null===t.distance?0:e.distance-t.distance);if(!l.value.trim())return t;const a=l.value.toLowerCase();return t.filter(e=>e.displayName.toLowerCase().includes(a))}),c=async e=>{const t=le.currentUser;if(!t)return;const a=(0,te.rJ)(oe,"follows");if(e.isFollowing){const s=(0,te.P)(a,(0,te._M)("followerId","==",t.uid),(0,te._M)("followingId","==",e.uid)),n=await(0,te.GG)(s);if(!n.empty){const e=n.docs[0].id;await(0,te.kd)((0,te.H9)(oe,"follows",e))}}else await(0,te.gS)(a,{followerId:t.uid,followingId:e.uid})},v=e=>{o.value=e,r.value=!0},p=()=>{r.value=!1,o.value=null};return{filteredUsers:d,loading:t,toggleFollow:c,searchQuery:l,isReviewsModalVisible:r,userForReviews:o,openReviewsModal:v,closeReviewsModal:p}}},ks=(0,Ie.A)(ws,[["render",qa],["__scopeId","data-v-e58e01e0"]]),ms=ks,hs={class:"review-page"},Ls={class:"review-card"},fs={class:"form-group"},ys=["disabled"],Cs=["value"],bs={key:0,class:"add-restaurant-prompt"},Rs={key:0,class:"add-restaurant-form"},Es={class:"form-group"},Ms={class:"form-group"},xs={class:"form-group"},Is={class:"form-group"},Xs={class:"form-group"},_s={class:"form-group"},zs=["disabled"],As={key:0,class:"error-message"},Us={class:"form-group"},Ss={key:0,class:"photo-actions"},Fs={key:1,class:"photo-preview"},Ks=["src"],Ps={key:1,class:"camera-modal"},Vs={ref:"videoPlayer",class:"camera-video",autoplay:"",playsinline:""},Hs={class:"form-group"},Bs={class:"star-rating-input"},Qs=["onMouseover","onClick","title"],Js={height:"28px",width:"28px",viewBox:"0 0 24 24",fill:"currentColor"},Ts=["d"],Gs={class:"form-group"},Ns={class:"tags-container"},$s=["onClick"],Ds={class:"form-group"},Ws={class:"new-tag-input"},Os=["disabled"],js={class:"form-group"},qs=["disabled"],Zs={key:2,class:"error-message"};function Ys(e,t,a,r,o,i){return(0,n.uX)(),(0,n.CE)("div",hs,[(0,n.Lk)("div",Ls,[(0,n.Lk)("form",{onSubmit:t[20]||(t[20]=(0,s.D$)((...e)=>r.submitReview&&r.submitReview(...e),["prevent"]))},[(0,n.Lk)("div",fs,[t[23]||(t[23]=(0,n.Lk)("label",{for:"restaurant"},"Restaurant",-1)),(0,n.bo)((0,n.Lk)("select",{id:"restaurant","onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedRestaurant=e),disabled:!!a.selectedRestaurantId,required:""},[t[21]||(t[21]=(0,n.Lk)("option",{disabled:"",value:""},"Please select a restaurant",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.restaurants,e=>((0,n.uX)(),(0,n.CE)("option",{key:e.id,value:e.id},(0,l.v_)(e.name),9,Cs))),128))],8,ys),[[s.u1,r.selectedRestaurant]]),a.selectedRestaurantId?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",bs,[t[22]||(t[22]=(0,n.eW)(" Can't find the restaurant? ",-1)),(0,n.Lk)("button",{type:"button",class:"link-button",onClick:t[1]||(t[1]=e=>r.showAddRestaurantForm=!r.showAddRestaurantForm)},(0,l.v_)(r.showAddRestaurantForm?"Cancel":"Add a new one"),1)]))]),r.showAddRestaurantForm?((0,n.uX)(),(0,n.CE)("div",Rs,[t[30]||(t[30]=(0,n.Lk)("h3",{class:"add-restaurant-header"},"Add New Restaurant",-1)),(0,n.Lk)("div",Es,[t[24]||(t[24]=(0,n.Lk)("label",{for:"new-rest-name"},"Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-rest-name","onUpdate:modelValue":t[2]||(t[2]=e=>r.newRestaurant.name=e),type:"text",required:""},null,512),[[s.Jo,r.newRestaurant.name]])]),(0,n.Lk)("div",Ms,[t[25]||(t[25]=(0,n.Lk)("label",{for:"new-rest-address"},"Address",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-rest-address","onUpdate:modelValue":t[3]||(t[3]=e=>r.newRestaurant.address=e),type:"text",required:""},null,512),[[s.Jo,r.newRestaurant.address]])]),(0,n.Lk)("div",xs,[t[26]||(t[26]=(0,n.Lk)("label",{for:"new-rest-city"},"City",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-rest-city","onUpdate:modelValue":t[4]||(t[4]=e=>r.newRestaurant.city=e),type:"text"},null,512),[[s.Jo,r.newRestaurant.city]])]),(0,n.Lk)("div",Is,[t[27]||(t[27]=(0,n.Lk)("label",{for:"new-rest-state"},"State",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-rest-state","onUpdate:modelValue":t[5]||(t[5]=e=>r.newRestaurant.state=e),type:"text"},null,512),[[s.Jo,r.newRestaurant.state]])]),(0,n.Lk)("div",Xs,[t[28]||(t[28]=(0,n.Lk)("label",{for:"new-rest-zip"},"Zip Code",-1)),(0,n.bo)((0,n.Lk)("input",{id:"new-rest-zip","onUpdate:modelValue":t[6]||(t[6]=e=>r.newRestaurant.zip=e),type:"text"},null,512),[[s.Jo,r.newRestaurant.zip]])]),(0,n.Lk)("div",_s,[t[29]||(t[29]=(0,n.Lk)("label",{for:"url"},"Website URL",-1)),(0,n.bo)((0,n.Lk)("input",{id:"url","onUpdate:modelValue":t[7]||(t[7]=e=>r.newRestaurant.url=e),type:"url",placeholder:"https://example.com"},null,512),[[s.Jo,r.newRestaurant.url]])]),(0,n.Lk)("button",{type:"button",class:"btn-save-restaurant",onClick:t[8]||(t[8]=(...e)=>r.saveNewRestaurant&&r.saveNewRestaurant(...e)),disabled:r.isSavingRestaurant},(0,l.v_)(r.isSavingRestaurant?"Saving...":"Save Restaurant"),9,zs),r.addRestaurantError?((0,n.uX)(),(0,n.CE)("p",As,(0,l.v_)(r.addRestaurantError),1)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),(0,n.Lk)("div",Us,[t[33]||(t[33]=(0,n.Lk)("label",null,"Photo",-1)),r.photoDataUrl?((0,n.uX)(),(0,n.CE)("div",Fs,[(0,n.Lk)("img",{src:r.photoDataUrl,alt:"Review photo preview"},null,8,Ks),(0,n.Lk)("button",{type:"button",onClick:t[12]||(t[12]=(...e)=>r.removePhoto&&r.removePhoto(...e)),class:"btn-remove-photo",title:"Remove Photo"},"Ã—")])):((0,n.uX)(),(0,n.CE)("div",Ss,[(0,n.Lk)("button",{type:"button",onClick:t[9]||(t[9]=(...e)=>r.openCamera&&r.openCamera(...e)),class:"btn-secondary"},t[31]||(t[31]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("circle",{cx:"12",cy:"12",r:"3.2"}),(0,n.Lk)("path",{d:"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"})],-1),(0,n.eW)(" Take a Picture ",-1)])),(0,n.Lk)("button",{type:"button",onClick:t[10]||(t[10]=(...e)=>r.triggerFileUpload&&r.triggerFileUpload(...e)),class:"btn-secondary"},t[32]||(t[32]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M9 16h6v-6h4l-7-7-7 7h4v6zm3-10.17L14.17 8H13v6h-2V8H9.83L12 5.83zM5 18h14v2H5v-2z"})],-1),(0,n.eW)(" Upload Photo ",-1)])),(0,n.Lk)("input",{type:"file",ref:"fileInput",onChange:t[11]||(t[11]=(...e)=>r.handleFileUpload&&r.handleFileUpload(...e)),accept:"image/*",style:{display:"none"}},null,544)]))]),r.isCameraOpen?((0,n.uX)(),(0,n.CE)("div",Ps,[(0,n.Lk)("video",Vs,null,512),(0,n.Lk)("button",{type:"button",onClick:t[13]||(t[13]=(...e)=>r.capturePhoto&&r.capturePhoto(...e)),class:"btn-capture"},"Capture"),(0,n.Lk)("button",{type:"button",onClick:t[14]||(t[14]=(...e)=>r.closeCamera&&r.closeCamera(...e)),class:"btn-cancel-camera"},"Cancel")])):(0,n.Q3)("",!0),(0,n.Lk)("div",Hs,[t[35]||(t[35]=(0,n.Lk)("label",null,"Rating",-1)),(0,n.Lk)("div",Bs,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(5,e=>(0,n.Lk)("span",{key:e,class:"star",onMouseover:t=>r.hoverRating=e,onMouseleave:t[15]||(t[15]=e=>r.hoverRating=0),onClick:t=>r.rating=e,title:`${e} star${e>1?"s":""}`},[((0,n.uX)(),(0,n.CE)("svg",Js,[t[34]||(t[34]=(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"},null,-1)),(0,n.Lk)("path",{d:r.getStarPath(e)},null,8,Ts)]))],40,Qs)),64))])]),(0,n.Lk)("div",Gs,[t[36]||(t[36]=(0,n.Lk)("label",null,"Tags",-1)),(0,n.Lk)("div",Ns,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.tags,e=>((0,n.uX)(),(0,n.CE)("button",{key:e.id,type:"button",class:(0,l.C4)(["tag-btn",{selected:r.selectedTags.includes(e.name)}]),onClick:t=>r.toggleTag(e.name)},(0,l.v_)(e.name),11,$s))),128))])]),(0,n.Lk)("div",Ds,[t[37]||(t[37]=(0,n.Lk)("label",{for:"new-tag"},"Add a new tag",-1)),(0,n.Lk)("div",Ws,[(0,n.bo)((0,n.Lk)("input",{id:"new-tag","onUpdate:modelValue":t[16]||(t[16]=e=>r.newTag=e),onKeydown:t[17]||(t[17]=(0,s.jR)((0,s.D$)((...e)=>r.addNewTag&&r.addNewTag(...e),["prevent"]),["enter"])),placeholder:"e.g., crispy, peppery, huge"},null,544),[[s.Jo,r.newTag,void 0,{trim:!0}]]),(0,n.Lk)("button",{type:"button",onClick:t[18]||(t[18]=(...e)=>r.addNewTag&&r.addNewTag(...e)),disabled:!r.newTag.trim()},"Add Tag",8,Os)])]),(0,n.Lk)("div",js,[t[38]||(t[38]=(0,n.Lk)("label",{for:"comment"},"Comment",-1)),(0,n.bo)((0,n.Lk)("textarea",{id:"comment","onUpdate:modelValue":t[19]||(t[19]=e=>r.comment=e),rows:"4",placeholder:"How was the tenderloin?"},null,512),[[s.Jo,r.comment]])]),(0,n.Lk)("button",{type:"submit",disabled:r.submitting||!r.selectedRestaurant||!r.rating},(0,l.v_)(r.submitting?"Submitting...":"Submit Review"),9,qs),r.errorMessage?((0,n.uX)(),(0,n.CE)("p",Zs,(0,l.v_)(r.errorMessage),1)):(0,n.Q3)("",!0)],32)])])}var en=a(914);const tn={name:"Review",props:{selectedRestaurantId:{type:String,default:null}},emits:["reviewed"],setup(e,{emit:t}){const a=(0,Z.KR)([]),s=(0,Z.KR)(e.selectedRestaurantId||null),l=(0,Z.KR)(null),r=(0,Z.KR)(0),o=(0,Z.KR)(""),i=(0,Z.KR)(!1),u=(0,Z.KR)(""),d=(0,Z.KR)([]),c=(0,Z.KR)([]),v=(0,Z.KR)(""),p=(0,Z.KR)(!1),g=(0,Z.KR)({name:"",address:"",city:"",state:"",zip:"",url:""}),w=(0,Z.KR)(!1),k=(0,Z.KR)(""),m=(0,Z.KR)(!1),h=(0,Z.KR)(null),L=(0,Z.KR)(null),f=(0,Z.KR)(null),y=(0,Z.KR)(null),C=(0,Z.KR)(null),b="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z",R="M22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z",E=async()=>{const e=(0,te.P)((0,te.rJ)(oe,"tags"),(0,te.My)("name")),t=await(0,te.GG)(e);d.value=t.docs.map(e=>({id:e.id,...e.data()}))},M=()=>new Promise(t=>{navigator.geolocation&&!e.selectedRestaurantId?navigator.geolocation.getCurrentPosition(e=>{C.value={lat:e.coords.latitude,lng:e.coords.longitude},t()},()=>t(),{timeout:5e3}):t()}),x=()=>{if(!C.value||0===a.value.length)return;let e=null,t=1/0;a.value.forEach(a=>{if(a.location){const s=Ve(C.value.lat,C.value.lng,a.location.lat,a.location.lng);null!==s&&s<t&&(t=s,e=a)}}),e&&(s.value=e.id)},I=async()=>{if(e.selectedRestaurantId){const t=(0,te.H9)(oe,"restaurants",e.selectedRestaurantId),s=await(0,te.x7)(t);s.exists()&&(a.value=[{id:s.id,...s.data()}])}else{const e=(0,te.P)((0,te.rJ)(oe,"restaurants"),(0,te.My)("name")),t=await(0,te.GG)(e);a.value=t.docs.map(e=>({id:e.id,...e.data()})),await M(),x()}};(0,n.sV)(async()=>{await Promise.all([E(),I()])});const X=e=>{const t=r.value||l.value;return t>=e?b:R},_=e=>{const t=c.value.indexOf(e);t>-1?c.value.splice(t,1):c.value.push(e)},z=async()=>{const e=v.value.toLowerCase();if(e&&!d.value.some(t=>t.name===e))try{const t=await(0,te.gS)((0,te.rJ)(oe,"tags"),{name:e,createdAt:(0,te.O5)()}),a={id:t.id,name:e};d.value.push(a),d.value.sort((e,t)=>e.name.localeCompare(t.name)),c.value.push(e),v.value=""}catch(t){u.value="Failed to add new tag.",console.error("Error adding new tag: ",t)}else v.value=""},A=async()=>{const e=g.value.name.trim(),t=g.value.address.trim();if(e&&t){w.value=!0,k.value="";try{const n=(0,te.P)((0,te.rJ)(oe,"restaurants"),(0,te._M)("name","==",e),(0,te._M)("address","==",t)),l=await(0,te.GG)(n);if(!l.empty)return k.value="This restaurant already exists in the database.",void(w.value=!1);const r=[g.value.address,g.value.city,g.value.state,g.value.zip].filter(Boolean).join(", "),o=await(0,en.geocodeAddress)(r);if(!o)return k.value="Could not find a location for the provided address. Please check the address and try again.",void(w.value=!1);const i={...g.value,name:e,address:t,location:o,createdAt:(0,te.O5)()},u=await(0,te.gS)((0,te.rJ)(oe,"restaurants"),i),d={id:u.id,...i};a.value.push(d),a.value.sort((e,t)=>e.name.localeCompare(t.name)),s.value=u.id,p.value=!1,g.value={name:"",address:"",city:"",state:"",zip:"",url:""}}catch(n){console.error("Error saving new restaurant:",n),k.value="Failed to save restaurant. Please try again."}finally{w.value=!1}}else k.value="Restaurant name and address are required."},U=async()=>{m.value=!0,await(0,n.dY)();try{f.value=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),L.value&&(L.value.srcObject=f.value)}catch(e){console.error("Error accessing camera: ",e),u.value="Could not access the camera. Please check permissions.",m.value=!1}},S=()=>{f.value&&f.value.getTracks().forEach(e=>e.stop()),m.value=!1},F=()=>{const e=document.createElement("canvas"),t=L.value,a=1280,s=1280;let n=t.videoWidth,l=t.videoHeight;n>l?n>a&&(l*=a/n,n=a):l>s&&(n*=s/l,l=s),e.width=n,e.height=l;const r=e.getContext("2d");r.drawImage(t,0,0,n,l),h.value=e.toDataURL("image/jpeg",.8),S()},K=()=>{h.value=null},P=()=>{y.value.click()},V=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{h.value=e.target.result},e.readAsDataURL(t)}},H=async()=>{const e=le.currentUser;if(e&&s.value&&l.value){i.value=!0,u.value="";try{let a=null;if(h.value){const t=(0,ae.c7)(),s=`reviews/${e.uid}/${Date.now()}.jpg`,n=(0,ae.KR)(t,s),l=await(0,ae.ls)(n,h.value,"data_url");a=await(0,ae.qk)(l.ref)}const n=(0,te.O5)();await(0,te.gS)((0,te.rJ)(oe,"reviews"),{userId:e.uid,restaurantId:s.value,photoURL:a,rating:l.value,text:o.value,tags:c.value,createdAt:n,lastActivityAt:n});const r=(0,te.H9)(oe,"users",e.uid);await(0,te.mZ)(r,{reviewCount:(0,te.GV)(1)});const i=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",e.uid),(0,te._M)("restaurantId","==",s.value)),u=await(0,te.GG)(i);if(!u.empty){const e=u.docs[0];await(0,te.mZ)(e.ref,{completedAt:n})}t("reviewed")}catch(a){console.error("Error submitting check-in: ",a),u.value="Failed to submit check-in. Please try again."}finally{i.value=!1}}else u.value="Please select a restaurant and provide a rating."};return{restaurants:a,selectedRestaurant:s,rating:l,hoverRating:r,comment:o,submitting:i,errorMessage:u,getStarPath:X,submitReview:H,tags:d,selectedTags:c,newTag:v,toggleTag:_,addNewTag:z,showAddRestaurantForm:p,newRestaurant:g,isSavingRestaurant:w,addRestaurantError:k,saveNewRestaurant:A,isCameraOpen:m,photoDataUrl:h,videoPlayer:L,openCamera:U,closeCamera:S,capturePhoto:F,removePhoto:K,fileInput:y,triggerFileUpload:P,handleFileUpload:V}}},an=(0,Ie.A)(tn,[["render",Ys],["__scopeId","data-v-28b2aa48"]]),sn=an,nn={class:"recommendations-page"},ln={key:0,class:"loading-indicator"},rn={key:1},on={key:0,class:"no-restaurants-message"},un={key:1,class:"restaurant-list"},dn={class:"restaurant-details"},cn={class:"restaurant-name"},vn={class:"restaurant-meta"},pn=["title"],gn={class:"rating-text"},wn={class:"rating-count"},kn={key:1,class:"distance"},mn={class:"restaurant-address"},hn={class:"restaurant-actions"},Ln=["onClick","title"],fn=["href"],yn=["href"],Cn=["onClick"];function bn(e,t,a,s,r,o){const i=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",nn,[t[3]||(t[3]=(0,n.Lk)("div",{class:"page-header"},[(0,n.Lk)("h2",null,"Top 10 Recommendations"),(0,n.Lk)("p",null,"Based on reviews in the last 6 months within 100 miles of your location.")],-1)),s.loading?((0,n.uX)(),(0,n.CE)("div",ln,"Loading recommendations...")):((0,n.uX)(),(0,n.CE)("div",rn,[0===s.restaurants.length?((0,n.uX)(),(0,n.CE)("p",on," No recommendations found. ")):((0,n.uX)(),(0,n.CE)("ul",un,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.restaurants,a=>((0,n.uX)(),(0,n.CE)("li",{key:a.id,class:"restaurant-item"},[(0,n.Lk)("div",dn,[(0,n.Lk)("span",cn,(0,l.v_)(a.name),1),(0,n.Lk)("div",vn,[a.averageRating>0?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rating",title:`${a.averageRating.toFixed(2)} average rating`},[(0,n.bF)(i,{rating:a.averageRating},null,8,["rating"]),(0,n.Lk)("span",gn,(0,l.v_)(a.averageRating.toFixed(1)),1),(0,n.Lk)("span",wn,"("+(0,l.v_)(a.reviewCount)+" recent reviews)",1)],8,pn)):(0,n.Q3)("",!0),null!==a.distance?((0,n.uX)(),(0,n.CE)("span",kn,(0,l.v_)(a.distance.toFixed(1))+" miles away",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",mn,(0,l.v_)(a.address)+", "+(0,l.v_)(a.city)+", "+(0,l.v_)(a.state)+" "+(0,l.v_)(a.zip),1)]),(0,n.Lk)("div",hn,[(0,n.Lk)("button",{onClick:e=>s.toggleBucketList(a),class:(0,l.C4)(["action-btn",{"in-bucket-list":s.isInBucketList(a.id)}]),title:s.isInBucketList(a.id)?"Remove from Bucket List":"Add to Bucket List"},t[0]||(t[0]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M18 7h-2.06c-.33-3.2-2.46-5.8-5.94-5.8S4.39 3.8 4.06 7H2v12h16V7zM6.14 7c.2-1.92 1.6-3.48 3.86-3.8A4.002 4.002 0 0 1 14 7h-2.14c-.2-1.92-1.6-3.48-3.86-3.8zM16 17H4v-8h12v8z"})],-1)]),10,Ln),(0,n.Lk)("a",{href:s.getDirectionsUrl(a),target:"_blank",rel:"noopener noreferrer",class:"action-btn",title:"Get Directions"},t[1]||(t[1]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M22.43 10.59l-9.01-9.01c-.75-.75-2.07-.76-2.83 0l-9.01 9.01c-.76.75-.76 2.07 0 2.83l9.01 9.01c.75.75 2.07.75 2.83 0l9.01-9.01c.75-.76.75-2.08 0-2.83zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"})],-1)]),8,fn),(0,n.Lk)("a",{href:s.getDetailsUrl(a),target:"_blank",rel:"noopener noreferrer",class:"action-btn",title:"View Details on Google"},t[2]||(t[2]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.41-1.41L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1)]),8,yn),(0,n.Lk)("button",{class:"check-in-btn",onClick:t=>e.$emit("review-at",a.id)},"Review",8,Cn)])]))),128))]))]))])}const Rn={name:"Recommendations",components:{StarRating:Pe},emits:["review-at"],setup(){const e=(0,Z.KR)([]),t=(0,Z.KR)(!0),a=(0,Z.KR)(null),s=(0,Z.KR)(new Set);let l=()=>{};const r=async()=>{if(!a.value)return console.error("User location not available."),t.value=!1,void(e.value=[]);try{const t=await(0,te.GG)((0,te.rJ)(oe,"restaurants")),s=t.docs.map(e=>({id:e.id,...e.data()})),n=s.filter(e=>{if(!e.location||"number"!==typeof e.location.lat||"number"!==typeof e.location.lng)return!1;const t=Ve(a.value.lat,a.value.lng,e.location.lat,e.location.lng);return e.distance=t,null!==t&&t<=100}),l=new Date;l.setMonth(l.getMonth()-6);const r=te.Dc.fromDate(l),o=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("createdAt",">=",r)),i=await(0,te.GG)(o),u=i.docs.map(e=>e.data()),d=n.map(e=>{const t=u.filter(t=>t.restaurantId===e.id&&"number"===typeof t.rating);let a=0,s=0;if(t.length>0){const e=t.reduce((e,t)=>e+t.rating,0);a=e/t.length,s=t.length}return{...e,averageRating:a,reviewCount:s}}).filter(e=>e.reviewCount>0);d.sort((e,t)=>t.averageRating-e.averageRating),e.value=d.slice(0,10)}catch(s){console.error("Error fetching recommendations:",s)}finally{t.value=!1}};(0,n.sV)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{a.value={lat:e.coords.latitude,lng:e.coords.longitude},r(),u()},e=>{console.error("Geolocation failed. Using default location.",e),a.value={lat:41.5,lng:-90.5},r(),u()}):(console.error("Geolocation is not supported by this browser."),a.value={lat:41.5,lng:-90.5},r(),u())}),(0,n.hi)(()=>{l()});const o=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/maps/dir/?api=1&destination=${t}`},i=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/search?q=${t}`},u=()=>{const e=le.currentUser;if(!e)return;const t=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",e.uid));l=(0,te.aQ)(t,e=>{const t=new Set;e.forEach(e=>t.add(e.data().restaurantId)),s.value=t})},d=e=>s.value.has(e),c=async e=>{const t=le.currentUser;if(t)if(d(e.id)){const a=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",t.uid),(0,te._M)("restaurantId","==",e.id)),s=await(0,te.GG)(a);s.forEach(e=>(0,te.kd)(e.ref))}else await(0,te.gS)((0,te.rJ)(oe,"bucketListItems"),{userId:t.uid,restaurantId:e.id,createdAt:(0,te.O5)()})};return{restaurants:e,loading:t,getDirectionsUrl:o,getDetailsUrl:i,isInBucketList:d,toggleBucketList:c}}},En=(0,Ie.A)(Rn,[["render",bn],["__scopeId","data-v-7a582d05"]]),Mn=En,xn={class:"stats-page"},In={class:"stats-container"},Xn={key:0},_n={key:1,class:"stats-grid"},zn={class:"stat-card"},An={class:"stat-card"},Un={class:"stat-card"},Sn={class:"stat-card"},Fn={key:2},Kn={key:3,class:"log-container"};function Pn(e,t,a,s,r,o){return(0,n.uX)(),(0,n.CE)("div",xn,[t[5]||(t[5]=(0,n.Lk)("h2",null,"Database Stats",-1)),(0,n.Lk)("div",In,[s.statsLoading?((0,n.uX)(),(0,n.CE)("div",Xn,"Loading stats...")):s.stats?((0,n.uX)(),(0,n.CE)("ul",_n,[(0,n.Lk)("li",zn,[t[0]||(t[0]=(0,n.Lk)("strong",null,"Restaurants",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.restaurants),1)]),(0,n.Lk)("li",An,[t[1]||(t[1]=(0,n.Lk)("strong",null,"Users",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.users),1)]),(0,n.Lk)("li",Un,[t[2]||(t[2]=(0,n.Lk)("strong",null,"Reviews",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.reviews),1)]),(0,n.Lk)("li",Sn,[t[3]||(t[3]=(0,n.Lk)("strong",null,"Follows",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.follows),1)])])):((0,n.uX)(),(0,n.CE)("div",Fn,"Could not load stats.")),s.log.length>0?((0,n.uX)(),(0,n.CE)("div",Kn,[t[4]||(t[4]=(0,n.Lk)("h3",null,"Log:",-1)),(0,n.Lk)("pre",null,(0,l.v_)(s.log.join("\n")),1)])):(0,n.Q3)("",!0)])])}const Vn={name:"DatabaseStats",setup(){const e=(0,Z.KR)(null),t=(0,Z.KR)(!0),a=(0,Z.KR)([]),s=async()=>{t.value=!0;try{const t=["restaurants","users","reviews","follows"],a={},s=t.map(async e=>{const t=(0,te.rJ)(oe,e),s=await(0,te.d_)(t);a[e]=s.data().count});await Promise.all(s),e.value=a}catch(s){a.value.push("Error fetching collection stats: "+s.message),console.error("Error fetching stats:",s)}finally{t.value=!1}};return(0,n.sV)(s),{stats:e,statsLoading:t,log:a}}},Hn=(0,Ie.A)(Vn,[["render",Pn],["__scopeId","data-v-7fa04ecf"]]),Bn=Hn,Qn={class:"backfill-page"},Jn={key:0,class:"error-message"},Tn={key:1,class:"backfill-container"},Gn=["disabled"],Nn={key:1,class:"stats-section"},$n={class:"stats-grid"},Dn={class:"stat-card"},Wn={class:"stat-card"},On={class:"stat-card"},jn={key:2,class:"log-container"},qn={class:"log-content"};function Zn(e,t,a,s,r,o){return(0,n.uX)(),(0,n.CE)("div",Qn,[t[8]||(t[8]=(0,n.Lk)("h2",null,"Backfill Review Counts",-1)),t[9]||(t[9]=(0,n.Lk)("p",{class:"description"},[(0,n.eW)(" This tool recalculates and updates the "),(0,n.Lk)("code",null,"reviewCount"),(0,n.eW)(" field for all users by counting their actual reviews in the database. Use this to fix discrepancies between the leaderboard and actual review counts. ")],-1)),s.isAdmin?((0,n.uX)(),(0,n.CE)("div",Tn,[t[7]||(t[7]=(0,n.Lk)("div",{class:"info-box"},[(0,n.Lk)("h3",null,"How it works:"),(0,n.Lk)("ol",null,[(0,n.Lk)("li",null,"Scans all reviews in the database"),(0,n.Lk)("li",null,"Counts reviews per user"),(0,n.Lk)("li",null,[(0,n.eW)("Updates each user's "),(0,n.Lk)("code",null,"reviewCount"),(0,n.eW)(" field using batched writes")])])],-1)),(0,n.Lk)("button",{class:"btn-primary",disabled:s.running||!s.isAdmin,onClick:t[0]||(t[0]=(...e)=>s.runBackfill&&s.runBackfill(...e))},(0,l.v_)(s.running?"Running Backfill...":"Run Backfill"),9,Gn),s.status?((0,n.uX)(),(0,n.CE)("div",{key:0,class:(0,l.C4)(["status-message",{"status-error":s.hasError}])},(0,l.v_)(s.status),3)):(0,n.Q3)("",!0),s.stats.totalReviews>0?((0,n.uX)(),(0,n.CE)("div",Nn,[t[5]||(t[5]=(0,n.Lk)("h3",null,"Backfill Statistics:",-1)),(0,n.Lk)("div",$n,[(0,n.Lk)("div",Dn,[t[2]||(t[2]=(0,n.Lk)("strong",null,"Total Reviews Scanned",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.totalReviews),1)]),(0,n.Lk)("div",Wn,[t[3]||(t[3]=(0,n.Lk)("strong",null,"Users with Reviews",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.usersWithReviews),1)]),(0,n.Lk)("div",On,[t[4]||(t[4]=(0,n.Lk)("strong",null,"Users Updated",-1)),(0,n.Lk)("span",null,(0,l.v_)(s.stats.usersUpdated),1)])])])):(0,n.Q3)("",!0),s.logs.length>0?((0,n.uX)(),(0,n.CE)("div",jn,[t[6]||(t[6]=(0,n.Lk)("h3",null,"Operation Log:",-1)),(0,n.Lk)("div",qn,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.logs,(e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:"log-line"},(0,l.v_)(e),1))),128))])])):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("div",Jn,t[1]||(t[1]=[(0,n.Lk)("p",null,"â›” Only administrators can access this tool.",-1)])))])}const Yn={name:"BackfillAdmin",setup(){const e=(0,Z.KR)(!1),t=(0,Z.KR)(""),a=(0,Z.KR)([]),s=(0,Z.KR)({totalReviews:0,usersWithReviews:0,usersUpdated:0}),l=(0,Z.KR)(null),r=(0,n.EW)(()=>l.value&&"kennected.com@gmail.com"===l.value.email),o=(0,n.EW)(()=>t.value.toLowerCase().includes("error")||t.value.toLowerCase().includes("fail")),i=e=>{const t=(new Date).toLocaleTimeString();a.value.push(`[${t}] ${e}`)};(0,n.sV)(()=>{(0,ee.hg)(le,e=>{l.value=e})});const u=async()=>{if(r.value){if(confirm("This will update reviewCount for all users in the database. This may take a few minutes. Continue?")){e.value=!0,t.value="Starting backfill...",a.value=[],s.value={totalReviews:0,usersWithReviews:0,usersUpdated:0};try{i("Reading reviews collection...");const e=new Map,a=500;let n=null,l=0;while(1){const s=n?(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te.My)("createdAt"),(0,te.HM)(n),(0,te.AB)(a)):(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te.My)("createdAt"),(0,te.AB)(a)),r=await(0,te.GG)(s);if(r.empty)break;r.forEach(t=>{const a=t.data(),s=a.userId;s&&(e.set(s,(e.get(s)||0)+1),l+=1)}),n=r.docs[r.docs.length-1],t.value=`Scanned ${l} reviews...`,i(`Processed ${l} reviews...`)}s.value.totalReviews=l,s.value.usersWithReviews=e.size,i(`Found ${l} reviews across ${e.size} users.`),i("Reading users collection to map UIDs to document references...");const r=await(0,te.GG)((0,te.rJ)(oe,"users")),o=new Map;r.forEach(e=>{const t=e.data(),a=t?.uid||e.id;a&&o.set(a,(0,te.H9)(oe,"users",e.id))}),i(`Mapped ${o.size} user documents.`),i("Starting batched updates...");const u=Array.from(e.entries()),d=400;let c=0,v=0;for(let s=0;s<u.length;s+=d){const e=(0,te.wP)(oe),a=u.slice(s,s+d);let n=0;for(const[t,s]of a){const a=o.get(t);if(!a){i(`Warning: No user document found for uid=${t} â€” skipping`),c++;continue}const l=await(0,te.x7)(a);l.exists()?(e.update(a,{reviewCount:s}),n++,v++):i(`Warning: User document does not exist for uid=${t} â€” skipping`),c++}n>0&&(await e.commit(),i(`Committed batch: ${n} updates (processed ${c}/${u.length})`),t.value=`Updated ${c}/${u.length} users...`)}s.value.usersUpdated=v,t.value="Backfill completed successfully!",i(`Backfill complete. Processed ${c} users, updated ${v} user documents.`)}catch(n){console.error("Backfill failed:",n),t.value=`Error: ${n.message||"Backfill failed. See console for details."}`,i(`ERROR: ${n.message||String(n)}`)}finally{e.value=!1}}}else t.value="Error: Only administrators can run this operation."};return{running:e,status:t,logs:a,stats:s,isAdmin:r,hasError:o,runBackfill:u}}},el=(0,Ie.A)(Yn,[["render",Zn],["__scopeId","data-v-479a152f"]]),tl=el,al={class:"my-reviews-page"},sl={key:0,class:"loading-indicator"},nl={key:1,class:"no-reviews-message"},ll={key:2,class:"reviews-list"},rl={class:"card-header"},ol={class:"restaurant-name"},il={class:"review-date"},ul={key:0,class:"photo-container"},dl=["src"],cl={class:"card-body"},vl={class:"rating-display"},pl={key:0,class:"comment-text"},gl={key:1,class:"tags-container"},wl={__name:"MyReviews",props:{user:{type:Object,default:null}},emits:["go-to-review"],setup(e){const t=e,a=(0,Z.KR)(!0),s=(0,Z.KR)([]),r=(0,Z.KR)(new Map);let o=()=>{},i=()=>{};const u=e=>{if(!e)return s.value=[],a.value=!1,void(o&&o());a.value=!0;const t=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","==",e.uid),(0,te.My)("createdAt","desc"));o=(0,te.aQ)(t,e=>{s.value=e.docs.map(e=>({id:e.id,...e.data()})),a.value=!1},e=>{console.error("Error fetching reviews:",e),a.value=!1})};(0,n.sV)(()=>{i=(0,te.aQ)((0,te.rJ)(oe,"restaurants"),e=>{const t=new Map;e.forEach(e=>{t.set(e.id,e.data())}),r.value=t}),(0,n.wB)(()=>t.user,e=>{u(e)},{immediate:!0})}),(0,n.hi)(()=>{o&&o(),i&&i()});const d=(0,n.EW)(()=>s.value.map(e=>({...e,restaurantName:r.value.get(e.restaurantId)?.name||"Unknown Restaurant"}))),c=e=>e&&e.toDate?e.toDate().toLocaleDateString():"";return(e,t)=>((0,n.uX)(),(0,n.CE)("div",al,[t[3]||(t[3]=(0,n.Lk)("h2",null,"My Reviews",-1)),a.value?((0,n.uX)(),(0,n.CE)("div",sl,"Loading your reviews...")):0===d.value.length?((0,n.uX)(),(0,n.CE)("div",nl,[t[1]||(t[1]=(0,n.Lk)("p",null,"You haven't posted any reviews yet.",-1)),(0,n.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("go-to-review"))},"Post your first review!")])):((0,n.uX)(),(0,n.CE)("div",ll,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"review-card"},[(0,n.Lk)("div",rl,[(0,n.Lk)("span",ol,(0,l.v_)(e.restaurantName),1),(0,n.Lk)("span",il,(0,l.v_)(c(e.createdAt)),1)]),e.photoURL?((0,n.uX)(),(0,n.CE)("div",ul,[(0,n.Lk)("img",{src:e.photoURL,alt:"Review photo",class:"check-in-photo"},null,8,dl)])):(0,n.Q3)("",!0),(0,n.Lk)("div",cl,[(0,n.Lk)("div",vl,[(0,n.bF)(Pe,{rating:e.rating},null,8,["rating"])]),e.text?((0,n.uX)(),(0,n.CE)("p",pl,'"'+(0,l.v_)(e.text)+'"',1)):(0,n.Q3)("",!0),e.tags&&e.tags.length>0?((0,n.uX)(),(0,n.CE)("div",gl,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.tags,e=>((0,n.uX)(),(0,n.CE)("span",{key:e,class:"tag"},(0,l.v_)(e),1))),128))])):(0,n.Q3)("",!0)]),t[2]||(t[2]=(0,n.Lk)("div",{class:"card-actions"},null,-1))]))),128))]))]))}},kl=(0,Ie.A)(wl,[["__scopeId","data-v-1b40b4e8"]]),ml=kl,hl={class:"leaderboard-page"},Ll={key:0,class:"loading-indicator"},fl={key:1,class:"no-users-message"},yl={key:2,class:"leaderboard-list"},Cl={class:"rank-container"},bl={class:"rank"},Rl={key:0,class:"medal"},El=["src"],Ml={class:"user-info"},xl={class:"user-name"},Il={class:"review-count"};function Xl(e,t,a,s,r,o){return(0,n.uX)(),(0,n.CE)("div",hl,[t[1]||(t[1]=(0,n.Lk)("div",{class:"page-header"},[(0,n.Lk)("h2",null,"Leaderboard"),(0,n.Lk)("p",null,"Top 10 reviewers")],-1)),s.loading?((0,n.uX)(),(0,n.CE)("div",Ll,"Loading leaderboard...")):0===s.users.length?((0,n.uX)(),(0,n.CE)("div",fl,t[0]||(t[0]=[(0,n.Lk)("p",null,"No users to display on the leaderboard yet.",-1)]))):((0,n.uX)(),(0,n.CE)("ol",yl,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.users,(e,t)=>((0,n.uX)(),(0,n.CE)("li",{key:e.uid,class:(0,l.C4)(["leaderboard-item",s.getRankClass(t)])},[(0,n.Lk)("div",Cl,[(0,n.Lk)("span",bl,(0,l.v_)(t+1),1),s.getMedal(t)?((0,n.uX)(),(0,n.CE)("span",Rl,(0,l.v_)(s.getMedal(t)),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("img",{src:e.photoURL||"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"User",class:"user-avatar",referrerpolicy:"no-referrer"},null,8,El),(0,n.Lk)("div",Ml,[(0,n.Lk)("span",xl,(0,l.v_)(e.displayName),1),(0,n.Lk)("span",Il,(0,l.v_)(e.reviewCount||0)+" reviews",1)])],2))),128))]))])}const _l={name:"Leaderboard",setup(){const e=(0,Z.KR)(!0),t=(0,Z.KR)([]);let a=()=>{};(0,n.sV)(()=>{try{const s=(0,te.P)((0,te.rJ)(oe,"users"),(0,te.My)("reviewCount","desc"),(0,te.AB)(30));a=(0,te.aQ)(s,a=>{const s=a.docs.map(e=>e.data()),n=s.filter(e=>{const t=Number(e.reviewCount)||0;return t>0}),l=n.sort((e,t)=>{const a=Number(e.reviewCount)||0,s=Number(t.reviewCount)||0;return s-a});t.value=l.slice(0,10),e.value=!1},t=>{console.error("Error fetching leaderboard:",t),e.value=!1})}catch(s){console.error("Error setting up leaderboard listener:",s),e.value=!1}}),(0,n.hi)(()=>{a()});const s=e=>0===e?"ðŸ¥‡":1===e?"ðŸ¥ˆ":2===e?"ðŸ¥‰":e>=3&&e<10?"ðŸ…":null,l=e=>0===e?"rank-gold":1===e?"rank-silver":2===e?"rank-bronze":e>=3&&e<10?"rank-regular":"";return{loading:e,users:t,getMedal:s,getRankClass:l}}},zl=(0,Ie.A)(_l,[["render",Xl],["__scopeId","data-v-7088546b"]]),Al=zl,Ul={class:"followers-page"},Sl={key:0,class:"loading-indicator"},Fl={key:1},Kl={key:0,class:"no-followers-message"},Pl={class:"user-card-content"},Vl={class:"user-info"},Hl=["src"],Bl={class:"user-name"},Ql={key:0,class:"last-review"},Jl={class:"review-header"},Tl={class:"review-body"},Gl={key:0,class:"review-text"},Nl={key:1,class:"last-review no-review"},$l={class:"user-actions"},Dl=["onClick"];function Wl(e,t,a,s,r,o){const i=(0,n.g2)("UserReviewsModal"),u=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)(n.FK,null,[s.isReviewsModalVisible?((0,n.uX)(),(0,n.Wv)(i,{key:0,user:s.userForReviews,onClose:s.closeReviewsModal},null,8,["user","onClose"])):(0,n.Q3)("",!0),(0,n.Lk)("div",Ul,[s.loading?((0,n.uX)(),(0,n.CE)("div",Sl,"Loading followers...")):((0,n.uX)(),(0,n.CE)("div",Fl,[0===s.followers.length?((0,n.uX)(),(0,n.CE)("div",Kl,t[0]||(t[0]=[(0,n.Lk)("span",null,"No one is following you yet.",-1)]))):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.followers,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.uid,class:"user-card"},[(0,n.Lk)("div",Pl,[(0,n.Lk)("div",Vl,[(0,n.Lk)("img",{src:e.photoURL||"https://cdn-icons-png.flaticon.com/512/149/149071.png",class:"user-avatar",alt:"User",referrerpolicy:"no-referrer"},null,8,Hl),(0,n.Lk)("div",null,[(0,n.Lk)("span",Bl,(0,l.v_)(e.displayName),1)])]),e.lastReview?((0,n.uX)(),(0,n.CE)("div",Ql,[(0,n.Lk)("div",Jl,[t[1]||(t[1]=(0,n.eW)(" Latest review: ",-1)),(0,n.Lk)("strong",null,(0,l.v_)(e.lastReview.restaurantName),1)]),(0,n.Lk)("div",Tl,[(0,n.bF)(u,{rating:e.lastReview.rating},null,8,["rating"]),e.lastReview.text?((0,n.uX)(),(0,n.CE)("p",Gl,'"'+(0,l.v_)(e.lastReview.text)+'"',1)):(0,n.Q3)("",!0)])])):((0,n.uX)(),(0,n.CE)("div",Nl," No reviews yet. "))]),(0,n.Lk)("div",$l,[(0,n.Lk)("button",{onClick:t=>s.openReviewsModal(e),class:"action-btn",title:"View Reviews"},t[2]||(t[2]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})],-1)]),8,Dl)])]))),128))]))])],64)}const Ol={name:"Followers",components:{UserReviewsModal:gs,StarRating:Pe},setup(){const e=(0,Z.KR)([]),t=(0,Z.KR)(!0),a=(0,Z.KR)(!1),s=(0,Z.KR)(null),l=async()=>{t.value=!0;const a=le.currentUser;if(!a)return void(t.value=!1);const s=(0,te.P)((0,te.rJ)(oe,"follows"),(0,te._M)("followingId","==",a.uid)),n=await(0,te.GG)(s),l=n.docs.map(e=>e.data().followerId);if(0===l.length)return e.value=[],void(t.value=!1);const r=await(0,te.GG)((0,te.rJ)(oe,"restaurants")),o=new Map;r.forEach(e=>{o.set(e.id,e.data().name)});const i=[];for(let e=0;e<l.length;e+=30){const t=l.slice(e,e+30);if(t.length>0){const e=(0,te.P)((0,te.rJ)(oe,"users"),(0,te._M)("uid","in",t)),a=await(0,te.GG)(e);a.forEach(e=>{i.push({uid:e.id,...e.data()})})}}const u=await Promise.all(i.map(async e=>{const t=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","==",e.uid),(0,te.My)("createdAt","desc"),(0,te.AB)(1)),a=await(0,te.GG)(t);let s=null;if(!a.empty){const e=a.docs[0].data();s={...e,restaurantName:o.get(e.restaurantId)||"Unknown Restaurant"}}return{...e,lastReview:s}}));e.value=u,t.value=!1};(0,n.sV)(l);const r=e=>{s.value=e,a.value=!0},o=()=>{a.value=!1,s.value=null};return{followers:e,loading:t,isReviewsModalVisible:a,userForReviews:s,openReviewsModal:r,closeReviewsModal:o}}},jl=(0,Ie.A)(Ol,[["render",Wl],["__scopeId","data-v-37e2860a"]]),ql=jl,Zl={class:"bucket-list-page"},Yl={class:"page-header"},er={class:"view-toggle"},tr={key:0,class:"loading-indicator"},ar={key:1,class:"no-items-message"},sr={key:0},nr={key:1},lr={key:2,class:"restaurant-list"},rr={class:"restaurant-details"},or={class:"restaurant-name"},ir={class:"restaurant-meta"},ur=["title"],dr={class:"rating-text"},cr={class:"rating-count"},vr={key:1,class:"distance"},pr={class:"restaurant-address"},gr={class:"restaurant-actions"},wr=["onClick"],kr=["onClick"];function mr(e,t,a,s,r,o){const i=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)("div",Zl,[(0,n.Lk)("div",Yl,[(0,n.Lk)("div",er,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=e=>s.showCompleted=!1),class:(0,l.C4)({active:!s.showCompleted})},"To Try",2),(0,n.Lk)("button",{onClick:t[1]||(t[1]=e=>s.showCompleted=!0),class:(0,l.C4)({active:s.showCompleted})},"Completed",2)])]),s.loading?((0,n.uX)(),(0,n.CE)("div",tr,"Loading your bucket list...")):0===s.filteredItems.length?((0,n.uX)(),(0,n.CE)("div",ar,[s.showCompleted?((0,n.uX)(),(0,n.CE)("p",nr,"You haven't completed any bucket list items yet.")):((0,n.uX)(),(0,n.CE)("p",sr,"Your bucket list is empty. Add some restaurants to try!"))])):((0,n.uX)(),(0,n.CE)("div",lr,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.filteredItems,t=>((0,n.uX)(),(0,n.CE)("div",{key:t.id,class:"restaurant-item"},[(0,n.Lk)("div",rr,[(0,n.Lk)("span",or,(0,l.v_)(t.restaurant.name),1),(0,n.Lk)("div",ir,[t.restaurant.averageRating>0?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rating",title:`${t.restaurant.averageRating.toFixed(2)} average rating`},[(0,n.bF)(i,{rating:t.restaurant.averageRating},null,8,["rating"]),(0,n.Lk)("span",dr,(0,l.v_)(t.restaurant.averageRating.toFixed(1)),1),(0,n.Lk)("span",cr,"("+(0,l.v_)(t.restaurant.ratingCount)+")",1)],8,ur)):(0,n.Q3)("",!0),null!==t.restaurant.distance?((0,n.uX)(),(0,n.CE)("span",vr,(0,l.v_)(t.restaurant.distance.toFixed(1))+" miles away ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",pr,[(0,n.eW)((0,l.v_)(t.restaurant.address),1),t.restaurant.city?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.eW)(", "+(0,l.v_)(t.restaurant.city),1)],64)):(0,n.Q3)("",!0),t.restaurant.state?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)(", "+(0,l.v_)(t.restaurant.state),1)],64)):(0,n.Q3)("",!0),t.restaurant.zip?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.eW)((0,l.v_)(t.restaurant.zip),1)],64)):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",gr,[(0,n.Lk)("button",{onClick:e=>s.removeFromBucketList(t.id),class:"action-btn delete-btn"},"Remove",8,wr),(0,n.Lk)("button",{class:"check-in-btn",onClick:a=>e.$emit("review-at",t.restaurantId)},"Review",8,kr)])]))),128))]))])}const hr={name:"BucketList",components:{StarRating:Pe},emits:["review-at"],setup(){const e=(0,Z.KR)([]),t=(0,Z.KR)(!0),a=(0,Z.KR)(!1),s=(0,Z.KR)(null);let l=()=>{};const r=()=>{const a=le.currentUser;if(!a)return void(t.value=!1);const n=(0,te.P)((0,te.rJ)(oe,"bucketListItems"),(0,te._M)("userId","==",a.uid));l=(0,te.aQ)(n,async a=>{t.value=!0;const n=a.docs.map(e=>({id:e.id,...e.data()}));if(0===n.length)return e.value=[],void(t.value=!1);const l=[...new Set(n.map(e=>e.restaurantId))],r=new Map;if(l.length>0){for(let e=0;e<l.length;e+=30){const t=l.slice(e,e+30),a=(0,te.P)((0,te.rJ)(oe,"restaurants"),(0,te._M)((0,te.Fs)(),"in",t)),s=await(0,te.GG)(a);s.forEach(e=>r.set(e.id,{id:e.id,...e.data()}))}const t=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("restaurantId","in",l)),a=await(0,te.GG)(t),o={};a.forEach(e=>{const t=e.data();t.restaurantId&&"number"===typeof t.rating&&(o[t.restaurantId]||(o[t.restaurantId]={total:0,count:0}),o[t.restaurantId].total+=t.rating,o[t.restaurantId].count++)}),e.value=n.map(e=>{const t=r.get(e.restaurantId);if(!t)return null;const a=o[t.id];return t.averageRating=a?a.total/a.count:0,t.ratingCount=a?a.count:0,t.distance=s.value&&t.location?Ve(s.value.lat,s.value.lng,t.location.lat,t.location.lng):null,{...e,restaurant:t}}).filter(Boolean)}else e.value=[];t.value=!1})};(0,n.sV)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{s.value={lat:e.coords.latitude,lng:e.coords.longitude},r()},e=>{console.error("Error getting location for bucket list",e),r()}):r()}),(0,n.hi)(()=>{l()});const o=(0,n.EW)(()=>{const t=e.value.filter(e=>a.value?!!e.completedAt:!e.completedAt);return t.sort((e,t)=>null===e.restaurant.distance?1:null===t.restaurant.distance?-1:e.restaurant.distance-t.restaurant.distance)}),i=async e=>{confirm("Are you sure you want to remove this from your bucket list?")&&await(0,te.kd)((0,te.H9)(oe,"bucketListItems",e))},u=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/maps/dir/?api=1&destination=${t}`},d=e=>{const t=encodeURIComponent(`${e.name}, ${e.address}`);return`https://www.google.com/search?q=${t}`};return{loading:t,showCompleted:a,filteredItems:o,removeFromBucketList:i,getDirectionsUrl:u,getDetailsUrl:d}}},Lr=(0,Ie.A)(hr,[["render",mr],["__scopeId","data-v-0d9a2091"]]),fr=Lr,yr={class:"following-page"},Cr={key:0,class:"loading-indicator"},br={key:1},Rr={key:0,class:"no-users-message"},Er={class:"user-card-content"},Mr={class:"user-info"},xr=["src"],Ir={class:"user-details"},Xr={class:"user-name"},_r={key:0,class:"last-review"},zr={class:"review-header"},Ar={class:"review-body"},Ur={key:0,class:"review-text"},Sr={key:1,class:"last-review no-review"},Fr={class:"user-actions"},Kr=["onClick"],Pr=["onClick"];function Vr(e,t,a,s,r,o){const i=(0,n.g2)("UserReviewsModal"),u=(0,n.g2)("StarRating");return(0,n.uX)(),(0,n.CE)(n.FK,null,[s.isReviewsModalVisible?((0,n.uX)(),(0,n.Wv)(i,{key:0,user:s.userForReviews,onClose:s.closeReviewsModal},null,8,["user","onClose"])):(0,n.Q3)("",!0),(0,n.Lk)("div",yr,[s.loading?((0,n.uX)(),(0,n.CE)("div",Cr,"Loading users you follow...")):((0,n.uX)(),(0,n.CE)("div",br,[0===s.following.length?((0,n.uX)(),(0,n.CE)("div",Rr,t[0]||(t[0]=[(0,n.Lk)("span",null,"You are not following anyone yet.",-1)]))):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.following,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.uid,class:"user-card"},[(0,n.Lk)("div",Er,[(0,n.Lk)("div",Mr,[(0,n.Lk)("img",{src:e.photoURL||"https://cdn-icons-png.flaticon.com/512/149/149071.png",class:"user-avatar",alt:"User",referrerpolicy:"no-referrer"},null,8,xr),(0,n.Lk)("div",Ir,[(0,n.Lk)("span",Xr,(0,l.v_)(e.displayName),1)])]),e.lastReview?((0,n.uX)(),(0,n.CE)("div",_r,[(0,n.Lk)("div",zr,[t[1]||(t[1]=(0,n.eW)(" Latest review: ",-1)),(0,n.Lk)("strong",null,(0,l.v_)(e.lastReview.restaurantName),1)]),(0,n.Lk)("div",Ar,[(0,n.bF)(u,{rating:e.lastReview.rating},null,8,["rating"]),e.lastReview.text?((0,n.uX)(),(0,n.CE)("p",Ur,'"'+(0,l.v_)(e.lastReview.text)+'"',1)):(0,n.Q3)("",!0)])])):((0,n.uX)(),(0,n.CE)("div",Sr," No reviews yet. "))]),(0,n.Lk)("div",Fr,[(0,n.Lk)("button",{onClick:t=>s.openReviewsModal(e),class:"action-btn",title:"View Reviews"},t[2]||(t[2]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"currentColor"},[(0,n.Lk)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,n.Lk)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})],-1)]),8,Kr),(0,n.Lk)("button",{onClick:t=>s.unfollowUser(e),class:"unfollow-btn"},"Unfollow",8,Pr)])]))),128))]))])],64)}const Hr={name:"Following",components:{StarRating:Pe,UserReviewsModal:gs},setup(){const e=(0,Z.KR)([]),t=(0,Z.KR)(!0),a=(0,Z.KR)(!1),s=(0,Z.KR)(null);let l=()=>{};const r=async()=>{t.value=!0;const a=le.currentUser;if(!a)return void(t.value=!1);const s=(0,te.P)((0,te.rJ)(oe,"follows"),(0,te._M)("followerId","==",a.uid));l=(0,te.aQ)(s,async a=>{const s=a.docs.map(e=>e.data().followingId);if(0===s.length)return e.value=[],void(t.value=!1);const n=await(0,te.GG)((0,te.rJ)(oe,"restaurants")),l=new Map;n.forEach(e=>{l.set(e.id,e.data().name)});const r=[];for(let e=0;e<s.length;e+=30){const t=s.slice(e,e+30);if(t.length>0){const e=(0,te.P)((0,te.rJ)(oe,"users"),(0,te._M)("uid","in",t)),a=await(0,te.GG)(e);a.forEach(e=>{r.push({uid:e.id,...e.data()})})}}const o=await Promise.all(r.map(async e=>{const t=(0,te.P)((0,te.rJ)(oe,"reviews"),(0,te._M)("userId","==",e.uid),(0,te.My)("createdAt","desc"),(0,te.AB)(1)),a=await(0,te.GG)(t);let s=null;if(!a.empty){const e=a.docs[0].data();s={...e,restaurantName:l.get(e.restaurantId)||"Unknown Restaurant"}}return{...e,lastReview:s}}));e.value=o,t.value=!1})};(0,n.sV)(r),(0,n.hi)(()=>l());const o=async e=>{const t=le.currentUser;if(t&&window.confirm(`Are you sure you want to unfollow ${e.displayName}?`))try{const a=(0,te.P)((0,te.rJ)(oe,"follows"),(0,te._M)("followerId","==",t.uid),(0,te._M)("followingId","==",e.uid)),s=await(0,te.GG)(a);if(!s.empty){const e=s.docs[0].id;await(0,te.kd)((0,te.H9)(oe,"follows",e))}}catch(a){console.error("Error unfollowing user:",a),alert("Failed to unfollow user. Please try again.")}},i=e=>{s.value=e,a.value=!0},u=()=>{a.value=!1,s.value=null};return{following:e,loading:t,unfollowUser:o,isReviewsModalVisible:a,userForReviews:s,openReviewsModal:i,closeReviewsModal:u}}},Br=(0,Ie.A)(Hr,[["render",Vr],["__scopeId","data-v-1cf2c834"]]),Qr=Br;async function Jr(e){e&&e("Starting backfill...");const t=await(0,te.GG)((0,te.rJ)(oe,"reviews")),a={};t.forEach(e=>{const t=e.data(),s=t.userId;s&&(a[s]=(a[s]||0)+1)}),e&&e(`Found ${Object.keys(a).length} users with reviews.`);const s=(0,te.rJ)(oe,"users");let n=0;for(const[l,r]of Object.entries(a)){const t=(0,te.P)(s,(0,te._M)("uid","==",l)),o=await(0,te.GG)(t);o.forEach(async e=>{const t=(0,te.H9)(oe,"users",e.id);await(0,te.mZ)(t,{reviewCount:r})}),n+=1,e&&e(`Updated ${n}/${Object.keys(a).length} users...`)}return e&&e("Backfill complete."),a}const Tr={name:"App",components:{Home:Qe,Restaurants:Xa,BucketList:fr,UserSearch:ms,Review:sn,Recommendations:Mn,DatabaseStats:Bn,BackfillAdmin:tl,MyReviews:ml,Leaderboard:Al,Followers:ql,Following:Qr},setup(){const e=(0,Z.KR)(null),t=(0,Z.KR)("home"),a=(0,Z.KR)(null),s=(0,Z.KR)(window.innerWidth<768),l=(0,Z.KR)("26.01.15.133526"),r=(0,n.EW)(()=>e.value&&"kennected.com@gmail.com"===e.value.email),o=(0,Z.KR)(!1),i=(0,Z.KR)(""),u=async()=>{if(!r.value)return alert("Only admins can run this operation.");if(confirm("This will write review counts to many user documents. Are you sure you want to proceed?")){o.value=!0,i.value="Starting backfill...";try{await Jr(e=>{i.value=e}),i.value="Backfill completed successfully.",t.value="leaderboard"}catch(e){console.error("Backfill failed:",e),i.value="Backfill failed: "+(e?.message||String(e))}finally{o.value=!1,setTimeout(()=>i.value="",5e3)}}},d=new Set(["review","user-search","bucket-list","my-reviews","followers","following","database-stats","backfill-admin"]),c={home:"Home",restaurants:"Restaurants","bucket-list":"BucketList","user-search":"UserSearch",review:"Review","my-reviews":"MyReviews",recommendations:"Recommendations",leaderboard:"Leaderboard",cleanup:"Cleanup","database-stats":"DatabaseStats","backfill-admin":"BackfillAdmin",followers:"Followers",following:"Following"},v=(0,n.EW)(()=>c[t.value]||"Home"),p=()=>{s.value=!s.value};window.addEventListener("resize",()=>{s.value=window.innerWidth<768}),(0,ee.hg)(le,async a=>{if(e.value=a,a)try{const e=(0,te.H9)(oe,"users",a.uid),t=await(0,te.x7)(e);t.exists()||await(0,te.BN)(e,{uid:a.uid,displayName:a.displayName,email:a.email,photoURL:a.photoURL,createdAt:new Date,reviewCount:0})}catch(s){console.error("Error checking/creating user document:",s)}else d.has(t.value)&&(t.value="home")});const g=async()=>{try{await(0,ee.df)(le,re)}catch(e){alert("Login failed: "+e.message)}},w=async()=>{await(0,ee.CI)(le)},k=()=>{t.value="home"},m=()=>{t.value="restaurants"},h=()=>{t.value="user-search"},L=()=>{t.value="review"},f=()=>{t.value="my-reviews"},y=()=>{t.value="recommendations"},C=()=>{t.value="leaderboard"},b=()=>{t.value="database-stats"},R=()=>{t.value="backfill-admin"},E=()=>{t.value="followers"},M=()=>{t.value="following"},x=()=>{t.value="bucket-list"},I=e=>{a.value=e,t.value="review"};return{user:e,loginWithGoogle:g,logout:w,currentPage:t,goToHome:k,goToRestaurants:m,goToUserSearch:h,goToReview:L,goToMyReviews:f,goToRecommendations:y,goToLeaderboard:C,goToDatabaseStats:b,goToBackfillAdmin:R,goToFollowers:E,goToFollowing:M,goToBucketList:x,reviewAt:I,selectedRestaurantForReview:a,isSidebarCollapsed:s,toggleSidebar:p,isAdmin:r,currentComponent:v,appVersion:l,backfillInProgress:o,backfillStatus:i,runBackfill:u}}},Gr=(0,Ie.A)(Tr,[["render",f]]),Nr=Gr;(0,s.Ef)(Nr).mount("#app")},914:(e,t,a)=>{a.d(t,{geocodeAddress:()=>n});const s="kennected.com@gmail.com";async function n(e){if(!e||!e.trim())return console.error("Geocoding error: Address is empty."),null;const t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1&email=${s}`;try{const e=await fetch(t),a=await e.json();if(a&&a.length>0){const{lat:e,lon:t}=a[0];return{lat:parseFloat(e),lng:parseFloat(t)}}return null}catch(a){return console.error("Error during geocoding fetch:",a),null}}}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var l=t[s]={exports:{}};return e[s](l,l.exports,a),l.exports}a.m=e,(()=>{var e=[];a.O=(t,s,n,l)=>{if(!s){var r=1/0;for(d=0;d<e.length;d++){for(var[s,n,l]=e[d],o=!0,i=0;i<s.length;i++)(!1&l||r>=l)&&Object.keys(a.O).every(e=>a.O[e](s[i]))?s.splice(i--,1):(o=!1,l<r&&(r=l));if(o){e.splice(d--,1);var u=n();void 0!==u&&(t=u)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[s,n,l]}})(),(()=>{a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={524:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var n,l,[r,o,i]=s,u=0;if(r.some(t=>0!==e[t])){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(i)var d=i(a)}for(t&&t(s);u<r.length;u++)l=r[u],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(d)},s=self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[504],()=>a(630));s=a.O(s)})();
//# sourceMappingURL=app.87acac04.js.map